<div class="flex flex-col flex-auto min-w-0" *transloco="let t">
  <!-- Main -->
  <div class="flex-auto">
    <!-- Header -->

    <div class="bg-card h-full">
      <div class="flex-auto p-2 sm:p-4">

        <mat-card-title>
          <app-card-title title="Payroll {{isUploads ?' Uploads' : 'Run'}}" [sub]="!isUploads" [back]="true" [prev]="true" [next]="true" (prevTap)="stepper.previous()" (nextTap)="stepper.next()" (backTap)="forListview()" (submitTap)="saveDetails()"></app-card-title>
        </mat-card-title>

        <div class="flex flex-wrap- gap-2 place-content-start">
          <p><strong>{{detailForm.value.payrollCode}}</strong>_
          {{displayHeader()}}
        </p>
      </div>

      <mat-stepper #stepper  [selectedIndex]="0" (selectionChange)="onStepperSelectionChange($event)" >

        <!-- ======================================================== DETAILS ============================================================================= -->

        @if (!isUploads) {
          <mat-step [stepControl]="detailForm" [completed]="detailsSaved">
            <form [formGroup]="detailForm">
              <ng-template matStepLabel>Details</ng-template>
              <mat-card>
                <div class="grid grid-cols-12 gap-2 h-full">
                  <div class="col-span-9">
                    <div class="grid grid-cols-7 gap-2">
                      <mat-form-field class="field" appearance="outline">
                        <mat-label class="label-font-size">{{t('payrollCode')}}</mat-label>
                        <mat-icon class="mb-2" matPrefix
                        svgIcon="mat_outline:info"></mat-icon>
                        <input readonly autocomplete="off" matInput type="text" formControlName="payrollCode">
                      </mat-form-field>
                      <div class="field">
                        <app-dropdown  [isFix]="true"[control]="detailForm.get('payoutTypeID')" [options]="dropdownOptions.payoutTypeDef" [label]="'Payroll Type'" [icon]="'mat_outline:info'" (selected)="reset()" [type]="74"> </app-dropdown>
                      </div>
                      <mat-form-field class="field" appearance="outline">
                        <mat-label class="label-font-size">{{t('payrollCutoff')}}</mat-label>
                        <mat-icon class="mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                        <mat-select [placeholder]="'Payroll Cutoff'" formControlName="categoryPayroll" (selectionChange)="typeHandler($event, true)">
                          @for (item of payrollCutoff; track item) {
                            <mat-option
                            [value]="item.cutoffHeaderId">{{item.description}}</mat-option>
                          }
                        </mat-select>
                      </mat-form-field>
                      @if (detailForm.value.payoutTypeID === 12723) {
                        <mat-form-field class="field" appearance="outline">
                          <mat-label class="label-font-size">{{t('asOfDate')}}</mat-label>
                          <input matInput formControlName="asofdate" [matDatepicker]="ad" readonly
                            [placeholder]="'MM/DD/YYYY'">
                            <mat-datepicker-toggle matSuffix [for]="ad"></mat-datepicker-toggle>
                            <mat-datepicker #ad></mat-datepicker>
                          </mat-form-field>
                        }
                        <mat-form-field class="field" appearance="outline">
                          <mat-label class="label-font-size">{{t('year')}}</mat-label>
                          <mat-icon class="uploadbutton mb-2" matPrefix
                          svgIcon="mat_outline:info"></mat-icon>
                          <!-- <mat-select formControlName="year" (selectionChange)="cutoffSelectionHandler(true)"> -->
                            <mat-select formControlName="year" (selectionChange)="cutoffSelectionHandler(true); employeeChild()">
                            @for (item of year; track item) {
                              <mat-option [value]="item.id">
                                {{item.description}}
                              </mat-option>
                            }
                          </mat-select>
                        </mat-form-field>
                        <div class="field">
                          <app-dropdown  [isFix]="true"[control]="detailForm.get('month')" orderBy="dropdownID" [options]="dropdownOptions.monthlydef" [icon]="'mat_outline:info'" [type]="54" (selected)="cutoffSelectionHandler(true); employeeChild()"></app-dropdown>
                        </div>
                        @if (this.detailForm.value.payoutTypeID === 12719 || this.detailForm.value.payoutTypeID === 12722) {
                          <mat-form-field class="field" appearance="outline">
                            <mat-label class="label-font-size">{{t('cutOff')}}</mat-label>
                            <mat-select [placeholder]="'Cut Off'" formControlName="cutoffID" (selectionChange)="cutoffHandler($event,true); employeeChild()">
                              @for (item of cutoff; track item) {
                                <mat-option
                                [value]="item.id">{{item.description}}</mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                        }
                        @if (detailForm.value.payoutTypeID === 12720) {
                          <div class="field">
                            <app-dropdown  [isFix]="true"[control]="detailForm.get('finalStatus')" [options]="dropdownOptions.finalPayStatDef" [multiple]="true" [all]="true" [value]="this.dF?.finalStatus" [label]="'Final Pay Status'" [icon]="'mat_outline:info'" [type]="145"></app-dropdown>
                          </div>
                        }
                        <mat-form-field class="field" appearance="outline">
                          <mat-label class="label-font-size">{{t('payoutDate')}}</mat-label>
                          <input matInput formControlName="payoutDateDisplay" [matDatepicker]="db" readonly
                            [placeholder]="'yyyy-MM-dd'">
                            <mat-datepicker-toggle matSuffix [for]="db"></mat-datepicker-toggle>
                            <mat-datepicker #db></mat-datepicker>
                          </mat-form-field>
                        </div>
                        <div class="grid grid-cols-7 gap-2">
                          <mat-form-field class="w-full h-10 text-md" appearance="outline">
                            <mat-label class="label-font-size">{{t('subCompany')}}</mat-label>
                            <mat-icon class="icon mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                            <mat-select [multiple]="true" [placeholder]="'Sub Company'" formControlName="subCompany" (selectionChange)="branchHandler()" (openedChange)="onSelectOpen($event,inputChange_company)">
                              <mat-option class="select">
                                <input type="input" (click)="$event.stopPropagation()" (keydown.space)="$event.stopPropagation()" (keydown.control.a)="$event.stopPropagation(); $event.target.select()" class="border-2 pr-4 pl-4 search-field" [placeholder]="t('Find')  +  'Sub Company ' + ' ..'" [formControl]="inputChange_company">
                              </mat-option>
                              @if (subCompany?.length > 0) {
                                <mat-option [value]="0" (click)="selectAllHandler(allSubCompany,'subCompany', subCompany)"
                                #allSubCompany>Select All</mat-option>
                              }
                              @for (item of subCompany; track item) {
                                <mat-option [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          <mat-form-field class="w-full h-10 text-md" appearance="outline">
                            <mat-label class="label-font-size">{{t('branch')}}</mat-label>
                            <mat-icon class="icon mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                            <mat-select [multiple]="true" [placeholder]="'Branch'" formControlName="branch" (openedChange)="onSelectOpen($event,inputChange_branch)">
                              <mat-option class="select">
                                <input type="input" (click)="$event.stopPropagation()" (keydown.space)="$event.stopPropagation()" (keydown.control.a)="$event.stopPropagation(); $event.target.select()" class="border-2 pr-4 pl-4 search-field" [placeholder]="t('Find')  +  'Branch ' + ' ..'" [formControl]="inputChange_branch">
                              </mat-option>
                              @if (branch?.length > 0) {
                                <mat-option [value]="0" (click)="selectAllHandler(allBranch,'branch', branch)"
                                  #allBranch>Select All</mat-option>
                              }
                              @for (item of branch; track item) {
                                <mat-option [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          <mat-form-field class="w-full h-10 text-md" appearance="outline">
                            <mat-label class="label-font-size">{{t('employeeCategory')}}</mat-label>
                            <mat-icon class="icon mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                            <mat-select [multiple]="true" [placeholder]="'Employee Category'" formControlName="category" (openedChange)="onSelectOpen($event,inputChange_empCat)">
                              <mat-option class="select">
                                <input type="input" (click)="$event.stopPropagation()" (keydown.space)="$event.stopPropagation()" (keydown.control.a)="$event.stopPropagation(); $event.target.select()" class="border-2 pr-4 pl-4 search-field" [placeholder]="t('Find')  +  'Employee Category ' + ' ..'" [formControl]="inputChange_empCat">
                              </mat-option>
                              @if (category?.length > 0) {
                                <mat-option [value]="0" (click)="selectAllHandler(allCategory,'category', category)" #allCategory>Select
                                All</mat-option>
                              }
                              @for (item of category; track item) {
                                <mat-option [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          <mat-form-field class="w-full h-10 text-md" appearance="outline">
                            <mat-label class="label-font-size">{{t('department')}}</mat-label>
                            <mat-icon class="icon mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                            <mat-select [multiple]="true" [placeholder]="'Department'" formControlName="department" (openedChange)="onSelectOpen($event,inputChange_department)">
                              <mat-option class="select">
                                <input type="input" (click)="$event.stopPropagation()" (keydown.space)="$event.stopPropagation()" (keydown.control.a)="$event.stopPropagation(); $event.target.select()" class="border-2 pr-4 pl-4 search-field" [placeholder]="t('Find')  +  'Department ' + ' ..'" [formControl]="inputChange_department">
                              </mat-option>
                              @if (department?.length > 0) {
                                <mat-option [value]="0" (click)="selectAllHandler(allDepartment,'department', department)"
                                #allDepartment>Select All</mat-option>
                              }
                              @for (item of department; track item) {
                                <mat-option [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          <mat-form-field class="w-full h-10 text-md" appearance="outline">
                            <mat-label class="label-font-size">{{t('confidential')}}</mat-label>
                            <mat-icon class="icon mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                            <mat-select [multiple]="true" [placeholder]="'Confidential'" formControlName="confidential" (openedChange)="onSelectOpen($event,inputChange_confidential)">
                              <mat-option class="select">
                                <input type="input" (click)="$event.stopPropagation()" (keydown.space)="$event.stopPropagation()" (keydown.control.a)="$event.stopPropagation(); $event.target.select()" class="border-2 pr-4 pl-4 search-field" [placeholder]="t('Find')  +  'Confidential ' + ' ..'" [formControl]="inputChange_confidential">
                              </mat-option>
                              @if (confidential?.length > 0) {
                                <mat-option [value]="0" (click)="selectAllHandler(allConfidential,'confidential', confidential)"
                                #allConfidential>Select All</mat-option>
                              }
                              @for (item of confidential; track item) {
                                <mat-option [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          @if(this.detailForm.value.payoutTypeID === 12723){
                            <div class="field">
                                <app-dropdown  [isFix]="true"[control]="detailForm.get('status')" [options]="dropdownOptions.employeeStatusDef" [label]="'Employee Status'" [icon]="'mat_outline:info'" (selected)="employeeChild()" [type]="36" [multiple]="true" [isedit]="iseditdd" [all]="true"> </app-dropdown>
                              </div>
                          }
                          <mat-form-field class="field" appearance="outline">
                            <mat-label class="label-font-size">{{t('employee')}}</mat-label>
                            <mat-icon class="mb-2" matPrefix [svgIcon]="'mat_outline:info'"></mat-icon>
                            <mat-select formControlName="employee" [multiple]="multiple" [placeholder]="'Employee'" (infiniteScroll)="getNextBatch()" msInfiniteScroll [complete]="complete" [threshold]="'20%'" (openedChange)="onSelectOpen($event,inputChange)">
                              <mat-option class="select">
                                <input type="input" (click)="$event.stopPropagation()" (keydown.space)="$event.stopPropagation()" (keydown.control.a)="$event.stopPropagation(); $event.target.select()" class="border-2 pr-4 pl-4 search-field" [placeholder]="t('Find')  +  'Employee ' + ' ..'" [formControl]="inputChange">
                              </mat-option>
                              @if (employee?.length > 0) {
                                <mat-option    [value]="0" (click)="selectAllHandler(allEmployee,'employee', employee)" #allEmployee >Select All</mat-option>
                              }
                              @for (option of employee; track option) {
                                <mat-option [id]="option.encryptID" [value]="option.dropdownID" (click)="selectedEvent(option.dropdownID)">
                                  {{option.description}}
                                </mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          @if(this.detailForm.value.payoutTypeID == 12722 || this.detailForm.value.payoutTypeID === 12721 ||
                            this.detailForm.value.payoutTypeID === 12723 || this.detailForm.value.payoutTypeID === 12719){
                            <mat-form-field class="field" appearance="outline" >
                            <mat-label class="label-font-size">{{t('annualize')}}</mat-label>
                            <mat-icon class="uploadbutton mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                            <mat-select formControlName="annualize">
                              @for (item of annual; track item) {
                                <mat-option [value]="item.id">
                                  {{item.description}}
                                </mat-option>
                              }
                            </mat-select>
                          </mat-form-field>
                          }

                        </div>
                      </div>
                      <div class="col-span-3">
                        @if (this.detailForm.value.payoutTypeID === 12719 || this.detailForm.value.payoutTypeID === 12722) {
                          <textarea style="border-width: 1px; margin-top: 2px; border-radius: 3px; "  class="text-error area" name="questionText" cols="35" rows="8" placeholder="Description"
                          formControlName="description" required></textarea>
                        }
                        @if (this.detailForm.value.payoutTypeID === 12720 || this.detailForm.value.payoutTypeID === 12721 || this.detailForm.value.payoutTypeID === 12723) {
                          <div class="text-error area mb-2.5"></div>
                        }
                        <div class="col-span-2">
                          @if (this.detailForm.value.payoutTypeID == 12722 || this.detailForm.value.payoutTypeID === 12720 ||
                            this.detailForm.value.payoutTypeID === 12721 || this.detailForm.value.payoutTypeID === 12723 ||
                            this.detailForm.value.payoutTypeID === 12719 && this.weeklyDisplay) {
                            <button class="mt-0.5 w-[10px] mr-1"
                              (click)="finalList()" mat-flat-button [color]="'primary'"  matTooltip="Search">
                              <mat-icon class="mb-2" [svgIcon]="'mat_outline:search'"></mat-icon>
                            </button>
                          }
                          @if (this.detailForm.value.payoutTypeID == 12722 ||
                            this.detailForm.value.payoutTypeID === 12720 || this.detailForm.value.payoutTypeID === 12721 ||
                            this.detailForm.value.payoutTypeID === 12723 || this.detailForm.value.payoutTypeID === 12719) {
                            <button
                              (click)="dialogSetupCurrency()" mat-flat-button color="primary" class="text-md mt-0.5" matTooltip="Setup Currency"> Setup Currency
                            </button>
                          }
                          @if (this.detailForm.value.annualize === 1 && (this.detailForm.value.payoutTypeID == 12722 || this.detailForm.value.payoutTypeID === 12721 ||
                            this.detailForm.value.payoutTypeID === 12723 || this.detailForm.value.payoutTypeID === 12719)) {
                            <button
                              (click)="dialogSetupAnnualized()" mat-flat-button color="primary" class="mt-1 text-md ml-1" matTooltip="Annual Tax Projection"> Annual Tax Projection
                            </button>
                          }
                        </div>
                        <!-- <div class="grid grid-cols-2 gap-2">
                        <button class="mt-0.5 w-10" *ngIf="this.detailForm.value.payoutTypeID == 12722 || this.detailForm.value.payoutTypeID === 12720 || this.detailForm.value.payoutTypeID === 12721 || this.detailForm.value.payoutTypeID === 12723" (click)="finalList()" mat-flat-button [color]="'primary'"  matTooltip="Search">
                          <mat-icon class="mb-2" [svgIcon]="'mat_outline:search'"></mat-icon>
                        </button>
                        <button (click)="dialogSetupCurrency()" mat-flat-button color="primary" class="mt-[3px] text-md" matTooltip="Setup Currency"> Setup Currency
                        </button>
                      </div> -->
                      <!-- <div class="grid grid-rows-4 grid-flow-col gap-4">
                      <div class="row-start-3 row-span-2">
                        <button *ngIf="this.detailForm.value.payoutTypeID === 12720" (click)="finalList()" mat-flat-button [color]="'primary'"  matTooltip="Search">
                          <mat-icon class="mb-2" [svgIcon]="'mat_outline:search'"></mat-icon>
                        </button>
                      </div>
                    </div> -->
                  </div>
                </div>
                @if (this.detailForm.value.payoutTypeID == 12722 && this.specialDetailSource?.length > 0   ||
                  this.detailForm.value.payoutTypeID === 12720 && this.employeeDetailSource?.length > 0 ||
                  this.detailForm.value.payoutTypeID === 12723 && this.thirteenmonthDetailSource?.length > 0 ||
                  this.detailForm.value.payoutTypeID === 12721 && this.maternityDetailSource?.length > 0) {
                  <div class="border-t-2 pt-2 mt-2">
                    <div class="flex flex-wrap gap-2">
                      <div class="flex-grow"></div>
                      <mat-form-field class="text-md h-5" appearance="outline">
                        <mat-label class="label-font-size">{{t('employeeCode')}}</mat-label>
                        <input matInput [placeholder]="'Employee Code'" formControlName="employeeCode">
                      </mat-form-field>
                      <mat-form-field class="text-md h-5" appearance="outline">
                        <mat-label class="label-font-size">{{t('employeeName')}}</mat-label>
                        <input matInput [placeholder]="'Employee Name'" formControlName="employeeName">
                      </mat-form-field>
                      <button (click)="searchParams(this.detailForm,'details')" class="mb-5" mat-flat-button [color]="'primary'">
                        <mat-icon class="mb-2" [svgIcon]="'mat_outline:search'"></mat-icon>
                        <span class="hidden sm:inline-block ml-2">Search</span>
                      </button>
                      <button class="mb-5" mat-flat-button color="primary">
                        <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                      </button>
                    </div>
                  </div>
                }
                <!-- ------------ Details Table ---------- -->
                @if (this.detailForm.value.payoutTypeID === 12719 && !this.weeklyDisplay) {
                  <div class="mt-10 mb-10 h-[55vh]">
                    <app-generate [datasource]="detailsSource" [cols]="detailsColumns" [hideCols]="isHide" [details]="isDetails" [empStatus]="isStatus"></app-generate>
                  </div>
                }
                @if (this.detailForm.value.payoutTypeID === 12719 && this.weeklyDisplay && this.regularWeeklySource.length > 0) {
                  <div class="mt-10 mb-10 h-[55vh]">
                    <app-generate [datasource]="regularWeeklySource"
                      (headersChecked)="headerList = $event"
                      [headersfromParent]="headerList"
                      (selectedList)="selected = $event"
                      (selected)="detailCheck = $event;payregTable()"
                      (excludedList)="excluded = $event"
                      (tablefilter)="nextPage($event,'details','',false)"
                      [checkboxLabel]="false"
                      [totalRows]="totalRowsDetail"
                      [cols]="regularWeeklyColumns"
                      [details]="false"
                      [hideCols]="true">
                    </app-generate>
                  </div>
                }
                @if (this.employeeDetailSource.length > 0) {
                  <div class="mb-10 h-[55vh]">
                    <app-generate [datasource]="employeeDetailSource"
                      (headersChecked)="headerList = $event"
                      [headersfromParent]="headerList"
                      (selected)="detailCheck = $event;payregTable()"
                      (excludedList)="excluded = $event"
                      (selectedList)="selected = $event"
                      (tablefilter)="nextPage($event,'details','',false)"
                      [checkboxLabel]="false"
                      [totalRows]="totalRowsDetail"
                      [cols]="employeeDetailColumns"
                      [details]="false"
                      [hideCols]="true">
                    </app-generate>
                  </div>
                }
                @if (this.specialDetailSource.length > 0) {
                  <div class="mb-10 h-[55vh]">
                    <app-generate [datasource]="specialDetailSource"
                      (headersChecked)="headerList = $event"
                      [headersfromParent]="headerList"
                      (selectedList)="selected = $event"
                      (selected)="detailCheck = $event;payregTable()"
                      (excludedList)="excluded = $event"
                      (tablefilter)="nextPage($event,'details','',false)"
                      [checkboxLabel]="false"
                      [totalRows]="totalRowsDetail"
                      [cols]="specialDetailColumns"
                      [details]="false"
                      [hideCols]="true">
                      <!-- (headersChecked)="headerList = $event" -->
                    </app-generate>
                  </div>
                }
                @if (this.maternityDetailSource.length > 0) {
                  <div class="mb-10 h-[55vh]">
                    <app-generate [datasource]="maternityDetailSource"
                      (headersChecked)="headerList = $event"
                      [headersfromParent]="headerList"
                      (selectedList)="selected = $event"
                      (selected)="detailCheck = $event;payregTable()"
                      (excludedList)="excluded = $event"
                      (tablefilter)="nextPage($event,'details','',false)"
                      [checkboxLabel]="false"
                      [totalRows]="totalRowsDetail"
                      [cols]="maternityDetailColumns"
                      [details]="false"
                      [hideCols]="true">
                    </app-generate>
                  </div>
                }
                @if (this.thirteenmonthDetailSource.length > 0) {
                  <div class="mb-10 h-[55vh]">
                    <app-generate [datasource]="thirteenmonthDetailSource"
                      (headersChecked)="headerList = $event"
                      [headersfromParent]="headerList"
                      (selectedList)="selected = $event"
                      (selected)="detailCheck = $event;payregTable()"
                      (excludedList)="excluded = $event"
                      (tablefilter)="nextPage($event,'details','',false)"
                      [checkboxLabel]="false"
                      [totalRows]="totalRowsDetail"
                      [cols]="thirteenmonthDetailColumns"
                      [details]="false"
                      [hideCols]="true">
                    </app-generate>
                  </div>
                }
              </mat-card>
            </form>
          </mat-step>
        }

        <!-- ===================================================== TIMEKEEPING =========================================================== -->

        @if (showSteper(1)) {
          <mat-step [stepControl]="timekeepingForm">
            <ng-template matStepLabel>Timekeeping</ng-template>
            <form [formGroup]="timekeepingForm">
              <mat-card>
                <!-- ============== UPLOAD FILE ============= -->
                <div class="grid grid-cols-2 gap-1">
                  <div class="border-2 p-4 rounded-sm">
                    <!-- ============= Timekeeping Type ============= -->
                    <div class="flex flex-wrap gap-2 h-12">
                      <mat-form-field appearance="outline" class="w-46 hover:w-60">
                        <mat-label class="label-font-size">{{t('timekeepingType')}}</mat-label>
                        <mat-icon class="uploadbutton mb-2" matPrefix
                        svgIcon="mat_outline:info"></mat-icon>
                        <mat-select (selectionChange)="resetType('tkt')" formControlName="timekeepingType" (ngModelChange)="tkSystemGenDD(false)">
                          @for (item of tk; track item) {
                            <mat-option [value]="item.id">
                              {{item.description}}
                            </mat-option>
                          }
                        </mat-select>
                      </mat-form-field>
                      @if (timekeepingForm.value.timekeepingType === 12686) {
                        <mat-form-field appearance="outline">
                          <mat-label class="label-font-size">{{t('timekeepingAttendance')}}</mat-label>
                          <mat-icon class="uploadbutton mb-2" matPrefix
                          svgIcon="mat_outline:info"></mat-icon>
                          <mat-select formControlName="timekeepingAttendance">
                            @for (item of code; track item) {
                              <mat-option [value]="item.dropdownID">{{item.description}}
                              </mat-option>
                            }
                          </mat-select>
                        </mat-form-field>
                      }
                      @if (timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 31202) {
                        <mat-form-field  class="w-32" appearance="outline">
                          <mat-label class="label-font-size"></mat-label>
                          <input multiple type="file" #tkFile (change)="uploadFileTk($event,'tkfile','tkt',false)"
                            class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                            accept=".xlsx" (click)="$event.target.value=null"/>
                            <input readonly matInput id="tkfile" (change)="uploadFileTk($event,'tkfile','tkt',false)" formControlName="uploadFile"
                              cdkFocusInitial class="z-0"  />
                              <mat-icon class="mb-2" matPrefix
                              svgIcon="mat_outline:upload"></mat-icon>
                              <button class="upload" matSuffix mat-button
                              color="primary" (click)="tkFile.click()" [disabled]="buttonDisabled">Upload</button>
                            </mat-form-field>
                          }
                          @if (timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 31202) {
                            <button  (click)="download(timekeepingForm.value.timekeepingType === 12703 ? 'Timekeeping Summary Upload template' : timekeepingForm.value.timekeepingType === 12704 ? 'Timekeeping Detailed Upload Template' : '')" class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'primary'" matTooltip="Download">
                              <mat-icon class="mb-2" [svgIcon]="'mat_outline:download'"></mat-icon>
                              <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                            </button>
                          }
                          @if (timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12686 || timekeepingForm.value.timekeepingType === 31202) {
                            <button
                              class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'warn'" (click)="Delete('tkt')" matTooltip="Delete">
                              <mat-icon class="mb-2" [svgIcon]="'mat_outline:delete'"></mat-icon>
                              <!-- <span class="hidden sm:inline-block ml-2">Delete</span> -->
                            </button>
                          }
                          @if ((timekeepingForm.value.timekeepingType === 12686 || timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 31202 || timekeepingForm.value.transactionType === 1) && this.showCancel) {
                            <button
                              class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                              <mat-icon class="mb-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                            </button>
                          }
                          @if (timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12686 || timekeepingForm.value.timekeepingType === 31202 && this.showSave) {
                            <button
                              class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="Save('first','tk')" matTooltip="Save">
                              <mat-icon class="mb-2" [svgIcon]="'mat_outline:save'"></mat-icon>
                              <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                            </button>
                          }
                        </div>
                        <!-- ============= Upload table ============= -->
                        @if (timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12686 || timekeepingForm.value.timekeepingType === 31202) {
                          <div  class="grid grid-cols-2">
                            @if (timekeepingForm.value.timekeepingType === 12703) {
                              <div>
                                <p class="text-md pl-3"><strong>Summary Saved files</strong></p>
                                <mat-card class="scroll-container mat-elevation-z0">
                                  <app-upload #tkTable
                                    [checkbox]="deleteShow"
                                    [cancel]="hideCancel"
                                    [viewer]="view"
                                    (selectDel)="delTableT = $event"
                                    [datasource]="TKTableSource"
                                    (deleted)="tkTableDelete = $event"
                                    [del]="tkTableDelete"
                                    (selected)="checkTableT = $event;checkersTk('utkT')"
                                    [isLoadDone]="true" [isSaveDone]="true">
                                  </app-upload>
                                </mat-card>
                              </div>
                            }
                            @if (timekeepingForm.value.timekeepingType === 12704) {
                              <div>
                                <p class="text-md pl-3"><strong>Detail Saved files</strong></p>
                                <mat-card class="scroll-container mat-elevation-z0">
                                  <app-upload #tkTable
                                    [checkbox]="deleteShow"
                                    [cancel]="hideCancel"
                                    [save]="showSave"
                                    [viewer]="view"
                                    (selectDel)="delTableT = $event"
                                    [datasource]="TKTableSource"
                                    (deleted)="tkTableDelete = $event"
                                    [del]="tkTableDelete"
                                    (selected)="checkTableT = $event;checkersTk('utkT')"
                                    [isLoadDone]="true" [isSaveDone]="true">
                                  </app-upload>
                                </mat-card>
                              </div>
                            }
                            @if (timekeepingForm.value.timekeepingType === 12686) {
                              <div>
                                <p class="text-md pl-3"><strong>Sys-Gen Saved files</strong></p>
                                @if (timekeepingForm.value.timekeepingType === 12686) {
                                  <mat-card class="scroll-container mat-elevation-z0">
                                    <app-upload #tkTable
                                      [checkbox]="deleteShow"
                                      [cancel]="hideCancel"
                                      [viewer]="view"
                                      (selectDel)="delTableS = $event"
                                      [datasource]="SysTableSource"
                                      (deleted)="sysTableDelete = $event"
                                      [del]="sysTableDelete"
                                      (selected)="checkTableS = $event;checkersTk('system')"
                                      [isLoadDone]="true"
                                      [isSaveDone]="true">
                                    </app-upload>
                                  </mat-card>
                                }
                              </div>
                            }
                            @if (timekeepingForm.value.timekeepingType === 31202) {
                              <div>
                                <p class="text-md pl-3"><strong>Summary Hours SysGen</strong></p>
                                <mat-card class="scroll-container mat-elevation-z0">
                                    <app-upload #tkTable
                                           [checkbox]="deleteShow"
                                           [cancel]="hideCancel"
                                           [viewer]="view"
                                           (selectDel)="delTableTS = $event"
                                           [datasource]="SysTKTableSource"
                                           (deleted)="sysTKTableDelete = $event"
                                           [del]="sysTKTableDelete"
                                           (selected)="checkTableTS = $event;checkersTk('utkS')"
                                           [isLoadDone]="true" [isSaveDone]="true">
                                    </app-upload>
                                </mat-card>
                               </div>
                            }
                            <div class="border-l-4">
                              <br>
                                @if (this.TkSource.length > 0) {
                                  <mat-card class="scroll-container mat-elevation-z0">
                                    <app-upload
                                      [checkbox]="deleteShow"
                                      [cancel]="hideCancel"
                                      [viewer]="view"
                                      (selectDel)="delTableTC = $event"
                                      [id]="tkfile"
                                      [datasource]="TkSource"
                                      (deleted)="isDelete = $event"
                                      (selected)="checkedListTk = $event;checkersTk('tkt')"
                                      [del]="isDelete"
                                      [isLoadDone]="loading"
                                      [isSaveDone]="saving" >
                                    </app-upload>
                                  </mat-card>
                                }
                              </div>
                            </div>
                          }
                        </div>
                        <div class="border-2 p-4 rounded-sm">
                          <!-- ============= Timekeeping Adjustment ============= -->
                          <div class="flex flex-wrap gap-2 h-12">
                            <mat-form-field appearance="outline" class="w-43 hover:w-60">
                              <mat-label class="label-font-size">{{t('timekeepingAdjustment')}}</mat-label>
                              <mat-icon class="uploadbutton mb-2" matPrefix
                              svgIcon="mat_outline:info"></mat-icon>
                              <mat-select (selectionChange)="resetType('tkTAB')" formControlName="timekeepingAdjustment" (ngModelChange)="tkSystemGenDD(true)">
                                @for (item of tk; track item) {
                                  <mat-option [value]="item.id">
                                    {{item.description}}
                                  </mat-option>
                                }
                              </mat-select>
                            </mat-form-field>
                            @if (timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12703) {
                              <mat-form-field class="w-32" appearance="outline">
                                <mat-label class="label-font-size"></mat-label>
                                <input multiple type="file" #tkABFile (change)="uploadFileTk($event,'tkABfile','tka',true)"
                                  class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                  accept=".xlsx" (click)="$event.target.value=null"/>
                                  <input readonly matInput id="tkABfile" (change)="uploadFileTk($event,'tkABfile','tka',true)" formControlName="uploadFile2"
                                    cdkFocusInitial class="z-0"  />
                                    <mat-icon class="mb-2" matPrefix
                                    svgIcon="mat_outline:upload"></mat-icon>
                                    <button class="upload" matSuffix mat-button
                                    color="primary" (click)="tkABFile.click()" [disabled]="buttonDisabled">Upload</button>
                                  </mat-form-field>
                                }
                                @if (timekeepingForm.value.timekeepingAdjustment === 12686) {
                                  <mat-form-field appearance="outline">
                                    <mat-label class="label-font-size">{{t('timekeepingAdjustmentCode')}}</mat-label>
                                    <mat-icon class="uploadbutton mb-2" matPrefix
                                    svgIcon="mat_outline:info"></mat-icon>
                                    <mat-select formControlName="timekeepingCode">
                                      @for (item of code; track item) {
                                        <mat-option [value]="item.id">
                                          {{item.description}}
                                        </mat-option>
                                      }
                                    </mat-select>
                                  </mat-form-field>
                                }
                                @if (timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12703) {
                                  <button
                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download" (click)="download(timekeepingForm.value.timekeepingAdjustment === 12703 ? 'Timekeeping Summary Upload template':'Timekeeping Detailed Upload Template')">
                                    <mat-icon class="mb-2" [svgIcon]="'mat_outline:download'"></mat-icon>
                                    <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                  </button>
                                }
                                @if (timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12686) {
                                  <button
                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" matTooltip="Delete" (click)="Delete('tka',0)">
                                    <mat-icon class="mb-2"
                                    [svgIcon]="'mat_outline:delete'"></mat-icon>
                                    <!-- <span class="hidden sm:inline-block ml-2">Delete</span> -->
                                  </button>
                                }
                                @if ((timekeepingForm.value.timekeepingAdjustment === 12686 || timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.transactionType === 12704) && this.showCancel) {
                                  <button
                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                    <mat-icon class="mb-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                  </button>
                                }
                                @if (timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12686 && this.showSave) {
                                  <button
                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="Save('second','tka')" matTooltip="Save">
                                    <mat-icon class="mb-2"
                                    [svgIcon]="'mat_outline:save'"></mat-icon>
                                    <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                  </button>
                                }
                              </div>
                              <!-- ============= Upload table ============= -->
                              @if (timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12686) {
                                <div  class="grid grid-cols-2">
                                  @if (timekeepingForm.value.timekeepingAdjustment === 12703) {
                                    <div>
                                      <p class="text-md pl-3"><strong>Summary Saved files</strong></p>
                                      <mat-card class="scroll-container mat-elevation-z0">
                                        <app-upload #tkTable
                                          [checkbox]="deleteShow"
                                          [cancel]="hideCancel"
                                          [viewer]="view"
                                          (selectDel)="delTableAB = $event"
                                          [datasource]="TKATableSource"
                                          (deleted)="tkaTableDelete = $event"
                                          [del]="tkaTableDelete"
                                          (selected)="checkTableTAB = $event;checkersTk('utkA')"
                                          [isLoadDone]="true" [isSaveDone]="true">
                                        </app-upload>
                                      </mat-card>
                                    </div>
                                  }
                                  @if (timekeepingForm.value.timekeepingAdjustment === 12704) {
                                    <div>
                                      <p class="text-md pl-3"><strong>Detail Saved files</strong></p>
                                      <mat-card class="scroll-container mat-elevation-z0">
                                        <app-upload #tkTable
                                          [checkbox]="deleteShow"
                                          [cancel]="hideCancel"
                                          [viewer]="view"
                                          (selectDel)="delTableAB = $event"
                                          [datasource]="TKATableSource"
                                          (deleted)="tkaTableDelete = $event"
                                          [del]="tkaTableDelete"
                                          (selected)="checkTableTAB = $event;checkersTk('utkA')"
                                          [isLoadDone]="true" [isSaveDone]="true">
                                        </app-upload>
                                      </mat-card>
                                    </div>
                                  }
                                  @if (timekeepingForm.value.timekeepingAdjustment === 12686) {
                                    <div>
                                      <p class="text-md pl-3"><strong>Sys-Gen Saved files</strong></p>
                                      @if (timekeepingForm.value.timekeepingType === 12686) {
                                        <mat-card class="scroll-container mat-elevation-z0">
                                          <app-upload #tkTable
                                            [checkbox]="deleteShow"
                                            [cancel]="hideCancel"
                                            [save]="showSave"
                                            [viewer]="view"
                                            (selectDel)="delTableSAB = $event"
                                            [datasource]="SysATableSource"
                                            (deleted)="sysATableDelete = $event"
                                            [del]="sysATableDelete"
                                            (selected)="checkTableS = $event;checkersTk('systemAB')"
                                            [isLoadDone]="true" [isSaveDone]="true">
                                          </app-upload>
                                        </mat-card>
                                      }
                                    </div>
                                  }
                                  <div class="border-l-4">
                                    <br>
                                      @if (this.TkABSource.length > 0) {
                                        <mat-card class="mat-elevation-z0">
                                          <app-upload [id]="tkfile2"
                                            [checkbox]="deleteShow"
                                            [cancel]="hideCancel"
                                            [viewer]="view"
                                            (selectDel)="delTableABC = $event"
                                            [datasource]="TkABSource"
                                            (deleted)="isDelete2 = $event"
                                            (selected)="checkedListTkAB = $event;checkersTk('tka')"
                                            [del]="isDelete2"
                                            [isLoadDone]="loading"
                                            [isSaveDone]="saving">
                                          </app-upload>
                                        </mat-card>
                                      }
                                    </div>
                                  </div>
                                }
                              </div>
                            </div>
                            <div class="mt-5">
                              <!-- ============= Filter Fields ============= -->
                              <div class="flex flex-wrap place-content-between">
                                <div class="flex flex-wrap gap-2 ">
                                  <mat-form-field class="text-md h-10" appearance="outline">
                                    <mat-label class="label-font-size">{{t('timekeeping')}}</mat-label>
                                    <mat-icon class="uploadbutton mb-2" matPrefix
                                    svgIcon="mat_outline:info"></mat-icon>
                                    <mat-select [disabled]="this.checkedListTk.length == 0" (selectionChange)="checkersTk('tkt'); switchTk('tkt')" formControlName="timekeeping">
                                      @for (item of tk1; track item) {
                                        <mat-option [value]="item.id">
                                          {{item.description}}
                                        </mat-option>
                                      }
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field class="text-md h-10" appearance="outline">
                                    <mat-label class="label-font-size">{{t('timekeepingAdjustment')}}</mat-label>
                                    <mat-icon class="uploadbutton mb-2" matPrefix
                                    svgIcon="mat_outline:info"></mat-icon>
                                    <mat-select [disabled]="this.checkedListTkAB.length == 0 || this.timekeepingForm.value.timekeepingAdjustment === 12703" (selectionChange)="checkersTk('tka'); switchTk('tka')" formControlName="attendance">
                                      @for (item of tk1; track item) {
                                        <mat-option [value]="item.id">
                                          {{item.description}}
                                        </mat-option>
                                      }
                                    </mat-select>
                                  </mat-form-field>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                  <mat-form-field class="text-md h-10" appearance="outline">
                                    <mat-label class="label-font-size"></mat-label>
                                    <input formControlName="search" matInput placeholder="Search...">
                                    <!-- <mat-icon matSuffix>search</mat-icon> -->
                                  </mat-form-field>
                                  <button (click)="searchParams(this.timekeepingForm,'details')" class="mb-5" mat-flat-button [color]="'primary'">
                                    <mat-icon class="mb-2"
                                    [svgIcon]="'mat_outline:search'"></mat-icon>
                                    <span class="hidden sm:inline-block ml-2">Search</span>
                                  </button>
                                  <button class="mb-5" mat-flat-button color="primary">
                                    <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                  </button>
                                </div>
                              </div>
                              <!-- ============= TK table ============= -->
                              @if (timekeepingForm.value.timekeepingType === 12704 && this.timekeepingSource.length > 0 && this.checkedListTk.length > 0 || timekeepingForm.value.timekeepingType === 12703 && this.timekeepingSource.length > 0 && this.checkedListTk.length > 0 || timekeepingForm.value.timekeepingType === 31202 && this.timekeepingSource.length > 0 && this.checkedListTk.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>TK Current Upload File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table [action]="true"
                                      [datasource]="timekeepingSource"
                                      (tablefilter)="nextPage($event,'tkt','',false)"
                                      [totalRows]="totalRows"
                                      [searchVal]="searchTermTk"
                                    [error]="columnHideT"></app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }

                              @if (timekeepingForm.value.timekeepingType === 31202 && this.sysTKUpload.length > 0 && this.checkTableTS.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>Summary Hours SysGen Uploaded File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table
                                    [action]="false"
                                    [datasource]="sysTKUpload"
                                    (tablefilter)="nextPage($event,'utkS','',true)"
                                    [totalRows]="totalRows"
                                    [searchVal]="searchTermTk"
                                    [error]="columnHideT"></app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }

                              @if ((timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704) && this.tkUpload.length > 0 && this.checkTableT.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>TK Uploaded File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table [action]="false"
                                      [datasource]="tkUpload"
                                      (tablefilter)="nextPage($event,'utkT','',true)"
                                      [totalRows]="totalRows"
                                      [searchVal]="searchTermTk"
                                      [error]="columnHideT">
                                    </app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }
                              @if (timekeepingForm.value.timekeepingType === 12686 && this.sysUpload.length > 0 && this.checkTableS.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>Sys-Gen Uploaded File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table [action]="false"
                                      [datasource]="sysUpload"
                                      (tablefilter)="nextPage($event,'system','',true)"
                                      [totalRows]="totalRows"
                                      [searchVal]="searchTermTk"
                                      [error]="columnHideT">
                                    </app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }
                              @if (timekeepingForm.value.timekeepingAdjustment === 12704 && this.timekeepingABSource.length > 0 && this.checkedListTkAB.length > 0 || timekeepingForm.value.timekeepingAdjustment === 12703 && this.timekeepingABSource.length > 0 && this.checkedListTkAB.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>TK ADJ Current Upload File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table [action]="false"
                                      [datasource]="timekeepingABSource"
                                      (tablefilter)="nextPage($event,'tka','',false)"
                                      [totalRows]="totalRows"
                                      [searchVal]="searchTermTk"
                                      [error]="columnHideT">
                                    </app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }
                              @if ((timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704) && this.timekeepingABSource.length > 0 && this.checkTableTAB.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>TK ADJ Uploaded File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table [action]="true"
                                      [datasource]="timekeepingABSource"
                                      (tablefilter)="nextPage($event,'utkA','',false)"
                                      [totalRows]="totalRows"
                                      [searchVal]="searchTermTk"
                                      [error]="columnHideT">
                                    </app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }
                              @if (timekeepingForm.value.timekeepingAdjustment === 12686 && this.sysUpload.length > 0 && this.checkTableS.length > 0) {
                                <div>
                                  <p class="text-lg pl-3 pt-5"><strong>Sys-Gen Uploaded File View</strong></p>
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-timekeeping-table [action]="false"
                                      [datasource]="sysAUpload"
                                      (tablefilter)="nextPage($event,'systemAB','',true)"
                                      [totalRows]="totalRows"
                                      [searchVal]="searchTermTk"
                                      [error]="columnHideT">
                                    </app-timekeeping-table>
                                  </mat-card>
                                </div>
                              }
                            </div>
                            <br><br><br>
                          </mat-card>
                        </form>
                      </mat-step>
                    }

                    <!-- ===================================================== EARNINGS =========================================================== -->

                    @if (showSteper(2)) {
                      <mat-step [stepControl]="earningForm">
                        <form [formGroup]="earningForm">
                          <ng-template matStepLabel>Earnings</ng-template>
                          <mat-card class="h-full">
                            <div class="grid grid-cols-10">
                              <mat-form-field appearance="outline" class="h-12 w-48">
                                <mat-label class="label-font-size">{{t('transactionType')}}</mat-label>
                                <mat-icon class="uploadbutton mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                <mat-select (selectionChange)="resetHeader('e')" formControlName="transactionType">
                                  @for (item of transac; track item) {
                                    <mat-option [value]="item.id">
                                      {{item.description}}
                                    </mat-option>
                                  }
                                </mat-select>
                              </mat-form-field>
                            </div>
                            @if (earningForm.value.transactionType == 1) {
                              <div class="relative h-[50vh]">
                                <app-datatable
                                  [tagType]="[{id:[],type:-4}]"
                                  [hideDropdown]="['typeId', 'recurringStart', 'recurringEnd']"
                                  [hideFilter]="true"
                                  [path]="'earnings-view'"
                                  [search_btn] = true
                                  [delete_btn] = true
                                  [reload_btn] = true
                                  >
                                </app-datatable>
                              </div>
                            }
                            <!-- ================ For Add Transaction Type =================== -->
                            <!-- <div class="grid grid-cols-2 p-1 gap-1"> -->
                            <!-- ================ Field for Earning =================== -->
                            @if (earningForm.value.transactionType == 2) {
                              <div class="border-2 p-4 rounded-sm">
                                <div class="flex flex-wrap gap-2 h-12">
                                  @if (earningForm.value.transactionType == 2) {
                                    <mat-form-field appearance="outline">
                                      <mat-label class="label-font-size">{{t('earningsType')}}</mat-label>
                                      <mat-icon class="uploadbutton mb-2" matPrefix
                                      svgIcon="mat_outline:info"></mat-icon>
                                      <mat-select (selectionChange)="resetType('eT')" formControlName="earningType">
                                        @for (item of earn; track item) {
                                          <mat-option [value]="item.id">
                                            {{item.description}}
                                          </mat-option>
                                        }
                                      </mat-select>
                                    </mat-form-field>
                                  }
                                  @if (earningForm.value.transactionType == 1 || earningForm.value.earningType == 2) {
                                    <mat-form-field class="w-32" appearance="outline">
                                      <mat-label class="label-font-size"></mat-label>
                                      <input type="file" #earningFile (change)="uploadFileEarn($event,'earningfile','eT')"
                                        class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                        accept=".xlsx" (click)="$event.target.value = null"/>
                                        <input readonly matInput id="earningfile" (change)="uploadFileEarn($event,'earningfile','eT')" formControlName="uploadFile"
                                          cdkFocusInitial class="z-0"  />
                                          <mat-icon class="mb-2" matPrefix
                                          svgIcon="mat_outline:upload"></mat-icon>
                                          <button class="upload" [disabled]="buttonDisabled" matSuffix mat-button
                                          color="primary" (click)="earningFile.click()">Upload</button>
                                        </mat-form-field>
                                      }
                                      @if (earningForm.value.earningType == 3) {
                                        <mat-form-field appearance="outline">
                                          <mat-label class="label-font-size">{{t('earningAttendanceCode')}}</mat-label>
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select formControlName="earningACode">
                                            @for (item of code; track item) {
                                              <mat-option [value]="item.id">
                                                {{item.description}}
                                              </mat-option>
                                            }
                                          </mat-select>
                                        </mat-form-field>
                                      }
                                      @if (earningForm.value.earningType == 2 || earningForm.value.transactionType == 1) {
                                        <button class="p-3 px-1 sm:px-4"
                                          mat-flat-button [color]="'primary'" matTooltip="Download" (click)="download('New Earnings Upload Template')">
                                          <mat-icon class="mb-2" [svgIcon]="'mat_outline:download'"></mat-icon>
                                          <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                        </button>
                                      }
                                      @if ((earningForm.value.earningType == 3 || earningForm.value.earningType == 2 || earningForm.value.transactionType == 1)) {
                                        <button
                                          class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('eT',0)" matTooltip="Delete">
                                          <mat-icon class="mb-2" [svgIcon]="'mat_outline:delete'"></mat-icon>
                                        </button>
                                      }
                                      @if ((earningForm.value.earningType == 3 || earningForm.value.earningType == 2 || earningForm.value.transactionType == 1) && this.showCancel) {
                                        <button
                                          class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                          <mat-icon class="mb-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                        </button>
                                      }
                                      @if (earningForm.value.earningType == 3 || earningForm.value.earningType == 2 || earningForm.value.transactionType == 1 || earningForm.value.earningType == 1) {
                                        <button
                                          class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="submit(this.earningForm.value.earningType,'earnings','first','earnType')"  matTooltip="Save"
                                          [disabled]="buttonDisabled">
                                          <mat-icon class="mb-2" [svgIcon]="'mat_outline:save'"></mat-icon>
                                        </button>
                                      }
                                      @if (earningForm.value.transactionType == 1) {
                                        <mat-form-field appearance="outline">
                                          <mat-label class="label-font-size">{{t('employeeName')}}</mat-label>
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select formControlName="employeeName">
                                            @for (item of employee; track item) {
                                              <mat-option [value]="item.id">
                                                {{item.description}}
                                              </mat-option>
                                            }
                                          </mat-select>
                                        </mat-form-field>
                                      }
                                      @if (earningForm.value.transactionType == 1) {
                                        <mat-form-field class="w-40" appearance="outline">
                                          <mat-label class="label-font-size">{{t('status')}}</mat-label>
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select formControlName="status">
                                            @for (item of status; track item) {
                                              <mat-option [value]="item.id">
                                                {{item.description}}
                                              </mat-option>
                                            }
                                          </mat-select>
                                        </mat-form-field>
                                      }
                                    </div>
                                    <div class="grid grid-cols-2 p-1 gap-1">
                                      @if (earningForm.value.earningType === 2) {
                                        <div class="grid grid-cols-2">
                                          <div>
                                            <p class="text-md pl-3"><strong>Saved files</strong></p>
                                            <mat-card class="scroll-container mat-elevation-z0">
                                              <app-upload #earnTable
                                                [checkbox]="deleteShow"
                                                [cancel]="hideCancel"
                                                [viewer]="view"
                                                [datasource]="EarnTableSource"
                                                (deleted)="earnTableDelete = $event"
                                                [del]="earnTableDelete"
                                                (selected)="checkTableE = $event;checkersEarn('ueT')"
                                                (selectDel)="delTableE = $event"
                                                [isLoadDone]="true" [isSaveDone]="true">
                                              </app-upload>
                                            </mat-card>
                                          </div>
                                          <div class="border-l-4">
                                            <br>
                                              @if (this.EarnSource.length > 0) {
                                                <mat-card class="scroll-container mat-elevation-z0">
                                                  <app-upload [id]="earnType"
                                                    [checkbox]="deleteShow"
                                                    [cancel]="hideCancel"
                                                    [viewer]="view"
                                                    (selectDel)="delTableEC = $event"
                                                    [datasource]="EarnSource"
                                                    (deleted)="earnDelete = $event"
                                                    (selected)="checkedList = $event;checkersEarn('eT')"
                                                    [del]="earnDelete"
                                                    [isLoadDone]="loading" [isSaveDone]="saving">
                                                  </app-upload>
                                                </mat-card>
                                              }
                                            </div>
                                          </div>
                                        }
                                        <div></div>
                                      </div>
                                    </div>
                                  }
                                  <!-- ================ Field for AB =================== -->
                                  <!-- <div  *ngIf="earningForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                  <div class="flex flex-wrap gap-2 h-12">
                                    <mat-form-field appearance="outline">
                                      <mat-icon class="uploadbutton mb-2" matPrefix
                                      svgIcon="mat_outline:info"></mat-icon>
                                      <mat-select (selectionChange)="resetType('eTAB')" formControlName="earningABType">
                                        <mat-option *ngFor="let item of earn" [value]="item.id">
                                          {{item.description}}
                                        </mat-option>
                                      </mat-select>
                                    </mat-form-field>
                                    <mat-form-field *ngIf="earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2" class="w-32" appearance="outline">
                                      <input multiple type="file" #earningABFile (change)="uploadFileEarn($event,'earningABfile','eTAB')"
                                        class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                        accept=".xlsx" (click)="$event.target.value = null"/>
                                        <input readonly matInput id="earningABfile" (change)="uploadFileEarn($event,'earningABfile','eTAB')" formControlName="uploadFile2"
                                          cdkFocusInitial class="z-0"  />
                                          <mat-icon class="mb-2" matPrefix
                                          svgIcon="mat_outline:upload"></mat-icon>
                                          <button class="upload" matSuffix mat-button
                                          color="primary" [disabled]="buttonDisabled" (click)="earningABFile.click()">Upload</button>
                                        </mat-form-field>
                                        <mat-form-field *ngIf="earningForm.value.earningABType == 3" appearance="outline">
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select formControlName="earningAdjCode">
                                            <mat-option *ngFor="let item of earn" [value]="item.id">
                                              {{item.description}}
                                            </mat-option>
                                          </mat-select>
                                        </mat-form-field>
                                        <button *ngIf="earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2"
                                          class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download">
                                          <mat-icon class="mb-2"
                                          [svgIcon]="'mat_outline:download'"></mat-icon>
                                        </button>
                                        <button *ngIf="earningForm.value.earningABType == 3 || earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2"
                                          class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('eTAB')" matTooltip="Delete">
                                          <mat-icon class="mb-2"
                                          [svgIcon]="'mat_outline:delete'"></mat-icon>
                                        </button>
                                        <button *ngIf="earningForm.value.earningABType == 3 || earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2"
                                          class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="Save('second')" matTooltip="Save" [disabled]="buttonDisabled">
                                          <mat-icon class="mb-2"
                                          [svgIcon]="'mat_outline:save'"></mat-icon>
                                        </button>
                                      </div>
                                      ================ Upload list view for AB ===================
                                      <mat-card *ngIf="this.EarnABSource.length > 0" class="scroll-container mat-elevation-z0">
                                        <app-upload [id]="earnTypeAB"
                                          [datasource]="EarnABSource"
                                          (deleted)="earnDelete2 = $event"
                                          (selected)="checkedListEarnAB = $event;checkersEarn('eTAB')"
                                          [del]="earnDelete2" [isLoadDone]="loading" [isSaveDone]="saving">
                                        </app-upload>
                                      </mat-card>
                                    </div> -->
                                  <!-- </div> -->
                                  <div class="mt-5">
                                    <!-- ================ Filter field=================== -->
                                    @if ((earningForm.value.transactionType === 2) && earningForm.value.earningType === 2 || earningForm.value.earningType === 3) {
                                      <div class="flex flex-wrap place-content-between">
                                        <div class="flex flex-wrap gap-2 ">
                                          <mat-form-field class="text-md h-10" appearance="outline">
                                            <mat-label class="label-font-size">{{t('earning')}}</mat-label>
                                            <mat-icon class="uploadbutton mb-2" matPrefix
                                            svgIcon="mat_outline:info"></mat-icon>
                                            <mat-select [disabled]="this.checkedList.length === 0" (selectionChange)="checkersEarn('eT')" formControlName="earning">
                                              @for (item of tk1; track item) {
                                                <mat-option [value]="item.id">
                                                  {{item.description}}
                                                </mat-option>
                                              }
                                            </mat-select>
                                          </mat-form-field>
                                          <!-- <mat-form-field class="text-md h-10" appearance="outline">
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select [disabled]="this.checkedListEarnAB.length == 0" (selectionChange)="checkersEarn('eTAB')" formControlName="attendance">
                                            <mat-option *ngFor="let item of tk1" [value]="item.id">
                                              {{item.description}}
                                            </mat-option>
                                          </mat-select>
                                        </mat-form-field> -->
                                      </div>
                                      <div class="flex flex-wrap gap-2">
                                        <mat-form-field class="text-md h-10" appearance="outline">
                                          <mat-label class="label-font-size"></mat-label>
                                          <input formControlName="search" matInput placeholder="Search...">
                                        </mat-form-field>
                                        <button class="mb-5" (click)="search('e')" mat-flat-button [color]="'primary'">
                                          <mat-icon class="mb-2"
                                          [svgIcon]="'mat_outline:search'"></mat-icon>
                                          <span class="hidden sm:inline-block ml-2">Search</span>
                                        </button>
                                        <button class="mb-5" mat-flat-button color="primary">
                                          <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                        </button>
                                      </div>
                                    </div>
                                  }
                                  <!-- ================ Table List view =================== -->
                                  @if ((earningForm.value.earning == 1 || earningForm.value.earning == 2) && earningSource.length > 0 || earningSource.length > 0) {
                                    <div>
                                      <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                      <mat-card class="scroll-container h-80 mat-elevation-z0">
                                        <app-earning [id]="earnT"
                                          [datasource]="earningSource"
                                          (tablefilter)="nextPage($event,'eT','',false)"
                                          [totalRows]="totalRows"
                                          [searchVal]="searchTermE"
                                          [error]="columnHideE">
                                        </app-earning>
                                      </mat-card>
                                    </div>
                                  }
                                  @if (this.checkTableE.length > 0 && this.checkedList.length === 0 && earningUpload.length > 0) {
                                    <div>
                                      <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                      <mat-card class="scroll-container h-80 mat-elevation-z0">
                                        <app-earning [datasource]="earningUpload"
                                          (tablefilter)="nextPage($event,'ueT','',true)"
                                          [totalRows]="totalRows"
                                          [searchVal]="searchTermE"
                                          [error]="columnHideE">
                                        </app-earning>
                                      </mat-card>
                                    </div>
                                  }
                                  @if ((earningForm.value.attendance == 1 || earningForm.value.attendance == 2) && earningABSource.length > 0) {
                                    <div>
                                      <mat-card class="scroll-container h-80 mat-elevation-z0">
                                        <app-earning [id]="earnT" [datasource]="earningABSource" (tablefilter)="nextPage($event,'eTAB','',false)" [totalRows]="totalRows" [searchVal]="searchTermE" [error]="columnHideE"></app-earning>
                                      </mat-card>
                                    </div>
                                  }
                                  <!-- <div *ngIf="earningForm.value.attendance == 1">
                                  <mat-card class="scroll-container h-80 mat-elevation-z0">
                                    <app-earning [id]="earnT" [action]="true" [datasource]="earningABSource" [searchVal]="searchTermE" [error]="columnHideE"></app-earning>
                                  </mat-card>
                                </div> -->
                                @if (earningForm.value.transactionType == 1 && earningESource.length > 0) {
                                  <div>
                                    <mat-card  class="scroll-container h-80 mat-elevation-z0">
                                      <app-earning [id]="earnT" [datasource]="earningESource" (tablefilter)="nextPage($event,'eE','',false)" [totalRows]="totalRows" [searchVal]="searchTermE" [error]="columnHideE"></app-earning>
                                    </mat-card>
                                  </div>
                                }
                                <!-- <mat-tab-group>
                                <mat-tab label="Earning Type">
                                  <div class="flex flex-wrap gap-2 place-content-end p-2">
                                    <button mat-flat-button color="primary" class="mt-[3px] text-md">
                                      <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:download"></mat-icon>Export
                                    </button>
                                    <mat-form-field class="text-md h-5" appearance="outline">
                                      <input matInput placeholder="Search">
                                    </mat-form-field>
                                    <button class="mt-[3px]" mat-flat-button [color]="'primary'">
                                      <mat-icon class="mb-2"
                                      [svgIcon]="'mat_outline:search'"></mat-icon>
                                      <span class="hidden sm:inline-block ml-2">Search</span>
                                    </button>
                                  </div>
                                  <mat-card class="scroll-container h-100 mat-elevation-z0">
                                    <app-earnings [datasource]="earningSource"></app-earnings>
                                  </mat-card>
                                  <div class="flex flex-wrap place-content-center">
                                    <button class="learn-more">
                                      <span class="circle" aria-hidden="true">
                                        <span class="icon arrow">
                                        </span>
                                      </span>
                                    </button>
                                    <button class="learn-more2">
                                      <span class="circle2" aria-hidden="true">
                                        <span class="icon2 arrow2"></span>
                                      </span>
                                    </button>
                                  </div>
                                </mat-tab>
                                <mat-tab label="Attendance Base">
                                  <div class="flex flex-wrap gap-2 place-content-end p-2">
                                    <button mat-flat-button color="primary" class="mt-[3px] text-md">
                                      <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:download"></mat-icon>Export
                                    </button>
                                    <mat-form-field class="text-md h-5" appearance="outline">
                                      <input matInput placeholder="Search">
                                    </mat-form-field>
                                    <button class="mt-[3px]" mat-flat-button [color]="'primary'">
                                      <mat-icon class="mb-2"
                                      [svgIcon]="'mat_outline:search'"></mat-icon>
                                      <span class="hidden sm:inline-block ml-2">Search</span>
                                    </button>
                                  </div>
                                  <mat-card class="scroll-container h-100 mat-elevation-z0">
                                    <app-earnings [datasource]="earningSource"></app-earnings>
                                  </mat-card>
                                  <div class="flex flex-wrap place-content-center">
                                    <button class="learn-more">
                                      <span class="circle" aria-hidden="true">
                                        <span class="icon arrow">
                                        </span>
                                      </span>
                                    </button>
                                    <button class="learn-more2">
                                      <span class="circle2" aria-hidden="true">
                                        <span class="icon2 arrow2"></span>
                                      </span>
                                    </button>
                                  </div>
                                </mat-tab>
                              </mat-tab-group> -->
                            </div>
                            @if (earningForm.value.earningType == 1) {
                              <div class="relative h-100">
                                <app-employee-earnings [shared]="true" [frequency]="detailForm.value.cutoffID" [payrollType]="detailForm.value.payoutTypeID" (formChanged)="PatchEarnings($event)" [_id]="selectedCategory" [data]="payrollearnForm" [hidebuttons]="true" [parentDetail]="parentDetail"></app-employee-earnings>
                              </div>
                            }
                            <br><br><br>
                            <!-- <div class="flex justify-center items-center">
                            <div class="gird grid-cols-2">
                              <button class="m-1" mat-flat-button [color]="'primary'" matStepperPrevious>
                                <mat-icon class="icon-size-5 mt-4" [svgIcon]="'mat_outline:arrow-sm-left'"></mat-icon>
                                <span class="hidden sm:inline-block mr-2">Back</span>
                              </button>
                              <button class="m-1" mat-flat-button [color]="'primary'" matStepperNext>
                                <span class="hidden sm:inline-block ml-2">Continue</span>
                                <mat-icon class="icon-size-5 mt-4" [svgIcon]="'mat_outline:arrow-sm-right'"></mat-icon>
                              </button>
                            </div>
                          </div> -->
                        </mat-card>
                      </form>
                    </mat-step>
                  }

                  <!-- ===================================================== DEDUCTIONS =========================================================== -->

                  @if (showSteper(3)) {
                    <mat-step [stepControl]="deductionForm">
                      <form [formGroup]="deductionForm">
                        <ng-template matStepLabel>Deductions</ng-template>
                        <mat-card class="h-full">
                          <div class="grid grid-cols-10">
                            <mat-form-field appearance="outline" class="h-12 w-48">
                              <mat-label class="label-font-size">{{t('transactionType')}}</mat-label>
                              <mat-icon class="uploadbutton mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                              <mat-select (selectionChange)="resetHeader('e')" formControlName="transactionType">
                                @for (item of transac; track item) {
                                  <mat-option [value]="item.id">
                                    {{item.description}}
                                  </mat-option>
                                }
                              </mat-select>
                            </mat-form-field>
                          </div>
                          @if (deductionForm.value.transactionType == 1) {
                            <div class="relative h-[50vh]">
                              <app-datatable
                                [tagType]="[{id:[],type:-4}]"
                                [hideDropdown]="['typeId', 'recurringStart', 'recurringEnd']"
                                [hideFilter]="true"
                                [path]="'deductions-view'"
                                [search_btn] = true
                                [delete_btn] = true
                                [reload_btn] = true
                                >
                              </app-datatable>
                            </div>
                          }
                          <!-- ================ For Add Transaction Type =================== -->
                          <!-- <div class="grid grid-cols-2 p-1 gap-1"> -->
                          <!-- ================ Field for Deduction =================== -->
                          @if (deductionForm.value.transactionType == 2) {
                            <div class="border-2 p-4 rounded-sm">
                              <div class="flex flex-wrap gap-2 h-12">
                                @if (deductionForm.value.transactionType == 2) {
                                  <mat-form-field appearance="outline">
                                    <mat-label class="label-font-size">{{t('deductionsType')}}</mat-label>
                                    <mat-icon class="uploadbutton mb-2" matPrefix
                                    svgIcon="mat_outline:info"></mat-icon>
                                    <mat-select (selectionChange)="resetType('dT')" formControlName="deductionType">
                                      @for (item of earn; track item) {
                                        <mat-option [value]="item.id">
                                          {{item.description}}
                                        </mat-option>
                                      }
                                    </mat-select>
                                  </mat-form-field>
                                }
                                @if (deductionForm.value.transactionType == 1 || deductionForm.value.deductionType == 2) {
                                  <mat-form-field class="w-32" appearance="outline">
                                    <mat-label class="label-font-size"></mat-label>
                                    <input multiple type="file" #deductionFile (change)="uploadFileDeduc($event,'deductionfile','dT')"
                                      class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                      accept=".xlsx" (click)="$event.target.value=null"/>
                                      <input readonly matInput id="deductionfile" (change)="uploadFileDeduc($event,'deductionfile','dT')" formControlName="uploadFile"
                                        cdkFocusInitial class="z-0"  />
                                        <mat-icon class="mb-2" matPrefix
                                        svgIcon="mat_outline:upload"></mat-icon>
                                        <button class="upload" matSuffix mat-button
                                        color="primary" [disabled]="buttonDisabled" (click)="deductionFile.click()">Upload</button>
                                      </mat-form-field>
                                    }
                                    @if (deductionForm.value.deductionType == 3) {
                                      <mat-form-field appearance="outline">
                                        <mat-label class="label-font-size">{{t('deductionAttendanceCode')}}</mat-label>
                                        <mat-icon class="uploadbutton mb-2" matPrefix
                                        svgIcon="mat_outline:info"></mat-icon>
                                        <mat-select formControlName="deductionACode">
                                          @for (item of code; track item) {
                                            <mat-option [value]="item.id">
                                              {{item.description}}
                                            </mat-option>
                                          }
                                        </mat-select>
                                      </mat-form-field>
                                    }
                                    @if (deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1) {
                                      <button
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download" (click)="download('New Deductions Upload Template')">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:download'"></mat-icon>
                                        <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                      </button>
                                    }
                                    @if (deductionForm.value.deductionType == 3 || deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1) {
                                      <button
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'"  (click)="Delete('dT',0)" matTooltip="Delete">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:delete'"></mat-icon>
                                      </button>
                                    }
                                    @if ((deductionForm.value.deductionType == 3 || deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1) && this.showCancel) {
                                      <button
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                        <mat-icon class="mb-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                      </button>
                                    }
                                    @if (deductionForm.value.deductionType == 3 || deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1 || deductionForm.value.deductionType == 1) {
                                      <button
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="submit(this.deductionForm.value.deductionType,'deduction','first','deductionType')" [disabled]="buttonDisabled" matTooltip="Save">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:save'"></mat-icon>
                                        <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                      </button>
                                    }
                                    @if (deductionForm.value.transactionType == 1) {
                                      <mat-form-field appearance="outline">
                                        <mat-label class="label-font-size">{{t('employeeName')}}</mat-label>
                                        <mat-icon class="uploadbutton mb-2" matPrefix
                                        svgIcon="mat_outline:info"></mat-icon>
                                        <mat-select formControlName="employeeName">
                                          @for (item of employee; track item) {
                                            <mat-option [value]="item.id">
                                              {{item.description}}
                                            </mat-option>
                                          }
                                        </mat-select>
                                      </mat-form-field>
                                    }
                                    @if (deductionForm.value.transactionType == 1) {
                                      <mat-form-field class="w-40" appearance="outline">
                                        <mat-label class="label-font-size">{{t('status')}}</mat-label>
                                        <mat-icon class="uploadbutton mb-2" matPrefix
                                        svgIcon="mat_outline:info"></mat-icon>
                                        <mat-select formControlName="status">
                                          @for (item of status; track item) {
                                            <mat-option [value]="item.id">
                                              {{item.description}}
                                            </mat-option>
                                          }
                                        </mat-select>
                                      </mat-form-field>
                                    }
                                  </div>
                                  <div class="grid grid-cols-2 p-1 gap-1">
                                    @if (deductionForm.value.deductionType === 2) {
                                      <div class="grid grid-cols-2">
                                        <div>
                                          <p class="text-md pl-3"><strong>Saved files</strong></p>
                                          <mat-card class="scroll-container mat-elevation-z0">
                                            <app-upload #deducTable
                                              [checkbox]="deleteShow"
                                              [cancel]="hideCancel"
                                              [viewer]="view"
                                              (selectDel)="delTableD = $event"
                                              [datasource]="DeductionTableSource"
                                              (deleted)="deducTableDelete = $event"
                                              [del]="deducTableDelete"
                                              (selected)="checkTableD = $event;checkersDeduc('udT')"
                                              [isLoadDone]="true" [isSaveDone]="true">
                                            </app-upload>
                                          </mat-card>
                                        </div>
                                        <div class="border-l-4">
                                          <br>
                                            @if (this.DeductionSource.length > 0) {
                                              <mat-card class="scroll-container mat-elevation-z0">
                                                <app-upload [id]="deductionType"
                                                  [checkbox]="deleteShow"
                                                  [cancel]="hideCancel"
                                                  [viewer]="view"
                                                  (selectDel)="delTableDC = $event"
                                                  [datasource]="DeductionSource"
                                                  (deleted)="deductionDelete = $event"
                                                  (selected)="checkedListDeduc = $event;checkersDeduc('dT')"
                                                  [del]="deductionDelete" [isLoadDone]="loading" [isSaveDone]="saving">
                                                </app-upload>
                                              </mat-card>
                                            }
                                          </div>
                                        </div>
                                      }
                                      <div></div>
                                    </div>
                                  </div>
                                }
                                <!-- ================ Field for AB =================== -->
                                <!-- <div  *ngIf="deductionForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                <div class="flex flex-wrap gap-2 h-12">
                                  <mat-form-field appearance="outline">
                                    <mat-icon class="uploadbutton mb-2" matPrefix
                                    svgIcon="mat_outline:info"></mat-icon>
                                    <mat-select (selectionChange)="resetType('dTAB')" formControlName="deductionABType">
                                      <mat-option *ngFor="let item of earn" [value]="item.id">
                                        {{item.description}}
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2" class="w-32" appearance="outline">
                                    <input multiple type="file" #deductionABFile (change)="uploadFileDeduc($event,'deductionABfile','dTAB')"
                                      class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                      accept=".xlsx" (click)="$event.target.value=null"/>
                                      <input readonly matInput id="deductionABfile" (change)="uploadFileDeduc($event,'deductionABfile','dTAB')" formControlName="uploadFile2"
                                        cdkFocusInitial class="z-0"  />
                                        <mat-icon class="mb-2" matPrefix
                                        svgIcon="mat_outline:upload"></mat-icon>
                                        <button class="upload" matSuffix mat-button
                                        color="primary" (click)="deductionABFile.click()" [disabled]="buttonDisabled">Upload</button>
                                      </mat-form-field>
                                      <mat-form-field *ngIf="deductionForm.value.deductionABType == 3" appearance="outline">
                                        <mat-icon class="uploadbutton mb-2" matPrefix
                                        svgIcon="mat_outline:info"></mat-icon>
                                        <mat-select formControlName="deductionAdjCode">
                                          <mat-option *ngFor="let item of earn" [value]="item.id">
                                            {{item.description}}
                                          </mat-option>
                                        </mat-select>
                                      </mat-form-field>
                                      <button *ngIf="deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2"
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:download'"></mat-icon>
                                      </button>
                                      <button *ngIf="deductionForm.value.deductionABType == 3 || deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2"
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('dTAB')" matTooltip="Delete">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:delete'"></mat-icon>
                                      </button>
                                      <button *ngIf="deductionForm.value.deductionABType == 3 || deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2"
                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="Save('second')" [disabled]="buttonDisabled" matTooltip="Save">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:save'"></mat-icon>
                                        <span class="hidden sm:inline-block ml-2">Save</span>
                                      </button>
                                      <mat-form-field *ngIf="deductionForm.value.transactionType == 3" appearance="outline">
                                        <mat-icon class="uploadbutton mb-2" matPrefix
                                        svgIcon="mat_outline:info"></mat-icon>
                                        <mat-select formControlName="deductionCode">
                                          <mat-option *ngFor="let item of earn" [value]="item.id">
                                            {{item.description}}
                                          </mat-option>
                                        </mat-select>
                                      </mat-form-field>
                                    </div>
                                    ================ Upload list view for AB ===================
                                    <mat-card *ngIf="this.DeductionABSource.length > 0" class="scroll-container mat-elevation-z0">
                                      <app-upload [id]="deductionTypeAB"
                                        [datasource]="DeductionABSource"
                                        (deleted)="deductionDelete2 = $event"
                                        (selected)="checkedListDeducAB = $event;checkersDeduc('dTAB')"
                                        [del]="deductionDelete2" [isLoadDone]="loading" [isSaveDone]="saving">
                                      </app-upload>
                                    </mat-card>
                                  </div> -->
                                <!-- </div> -->
                                <div class="mt-5">
                                  <!-- ================ Filter field=================== -->
                                  @if ((deductionForm.value.transactionType === 2) && deductionForm.value.deductionType === 2 || deductionForm.value.deductionType === 3) {
                                    <div class="flex flex-wrap place-content-between">
                                      <div class="flex flex-wrap gap-2 ">
                                        <mat-form-field class="text-md h-10" appearance="outline">
                                          <mat-label class="label-font-size">{{t('deduction')}}</mat-label>
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select [disabled]="this.checkedListDeduc.length == 0" (selectionChange)="checkersDeduc('dT'); switchDeduc('dT')" formControlName="deduction">
                                            @for (item of tk1; track item) {
                                              <mat-option [value]="item.id">
                                                {{item.description}}
                                              </mat-option>
                                            }
                                          </mat-select>
                                        </mat-form-field>
                                        <!-- <mat-form-field class="text-md h-10" appearance="outline">
                                        <mat-icon class="uploadbutton mb-2" matPrefix
                                        svgIcon="mat_outline:info"></mat-icon>
                                        <mat-select [disabled]="this.checkedListDeducAB.length == 0" (selectionChange)="checkersDeduc('dTAB'); switchDeduc('dTAB')" formControlName="attendance">
                                          <mat-option *ngFor="let item of tk1" [value]="item.id">
                                            {{item.description}}
                                          </mat-option>
                                        </mat-select>
                                      </mat-form-field> -->
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                      <mat-form-field class="text-md h-10" appearance="outline">
                                        <mat-label class="label-font-size"></mat-label>
                                        <input formControlName="search" matInput placeholder="Search...">
                                      </mat-form-field>
                                      <button (click)="search('d')" class="mb-5"  mat-flat-button [color]="'primary'">
                                        <mat-icon class="mb-2"
                                        [svgIcon]="'mat_outline:search'"></mat-icon>
                                        <span class="hidden sm:inline-block ml-2">Search</span>
                                      </button>
                                      <button class="mb-5" mat-flat-button color="primary">
                                        <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                      </button>
                                    </div>
                                  </div>
                                }
                                <!-- ================ Table List view =================== -->
                                @if ((deductionForm.value.deduction == 1 || deductionForm.value.deduction == 2) && deductionSource.length > 0 || deductionSource.length > 0) {
                                  <div>
                                    <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                    <mat-card class="scroll-container h-80 mat-elevation-z0">
                                      <app-deduction [id]="earnT" [datasource]="deductionSource" (tablefilter)="nextPage($event,'dT','',false)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                    </mat-card>
                                  </div>
                                }
                                @if (this.checkTableD.length > 0 && this.checkedListDeduc.length === 0) {
                                  <div>
                                    <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                    <mat-card class="scroll-container h-80 mat-elevation-z0">
                                      <app-deduction [datasource]="deductionUpload" (tablefilter)="nextPage($event,'udT','',true)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                    </mat-card>
                                  </div>
                                }
                                @if ((deductionForm.value.attendance == 1 || deductionForm.value.attendance == 2) && deductionABSource.length > 0) {
                                  <div>
                                    <mat-card class="scroll-container h-80 mat-elevation-z0">
                                      <app-deduction [id]="earnT" [datasource]="deductionABSource" (tablefilter)="nextPage($event,'dTAB','',false)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                    </mat-card>
                                  </div>
                                }
                                @if (deductionForm.value.transactionType == 1 && deductionESource.length > 0) {
                                  <div>
                                    <mat-card  class="scroll-container h-80 mat-elevation-z0">
                                      <app-deduction [id]="earnT" [datasource]="deductionESource" (tablefilter)="nextPage($event,'dE','',false)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                    </mat-card>
                                  </div>
                                }
                              </div>
                              @if (deductionForm.value.deductionType == 1) {
                                <div class="relative h-100">
                                  <app-payroll-deduction [shared]="true" [frequency]="detailForm.value.cutoffID" [payrollType]="detailForm.value.payoutTypeID" (formChanged)="PatchDeduction($event)" [_id]="selectedCategory" [data]="payrolldeducForm" [hidebuttons]="true" [parentDetail]="parentDetail"></app-payroll-deduction>
                                </div>
                              }
                              <!-- <div class="flex justify-center items-center">
                              <div class="gird grid-cols-2">
                                <button class="m-1" mat-flat-button [color]="'primary'" matStepperPrevious>
                                  <mat-icon class="icon-size-5 mt-4" [svgIcon]="'mat_outline:arrow-sm-left'"></mat-icon>
                                  <span class="hidden sm:inline-block mr-2">Back</span>
                                </button>
                                <button class="m-1" mat-flat-button [color]="'primary'" matStepperNext>
                                  <span class="hidden sm:inline-block ml-2">Continue</span>
                                  <mat-icon class="icon-size-5 mt-4" [svgIcon]="'mat_outline:arrow-sm-right'"></mat-icon>
                                </button>
                              </div>
                            </div> -->
                          </mat-card>
                        </form>
                      </mat-step>
                    }

                    <!-- ===================================================== LOANS =========================================================== -->

                    @if (showSteper(4)) {
                      <mat-step [stepControl]="loanForm">
                        <form [formGroup]="loanForm">
                          <ng-template matStepLabel>Loans</ng-template>
                          <mat-card class="h-full">
                            <div class="grid grid-cols-10">
                              <mat-form-field appearance="outline" class="h-12 w-48">
                                <mat-label class="label-font-size">{{t('transactionType')}}</mat-label>
                                <mat-icon class="uploadbutton mb-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                <mat-select (selectionChange)="resetHeader('e')" formControlName="transactionType">
                                  @for (item of transac; track item) {
                                    <mat-option [value]="item.id">
                                      {{item.description}}
                                    </mat-option>
                                  }
                                </mat-select>
                              </mat-form-field>
                            </div>
                            @if (loanForm.value.transactionType == 1) {
                              <div class="relative h-[50vh]">
                                <app-datatable
                                  [tagType]="[{id:[],type:-4}]"
                                  [hideDropdown]="['typeId', 'recurringStart', 'recurringEnd']"
                                  [search_btn] = true
                                  [delete_btn] = true
                                  [relaod_btn] = true
                                  [hideFilter]="true"
                                  [path]="'loans-view'">
                                </app-datatable>
                              </div>
                            }
                            <!-- ============== For Loan Edit Transaction Type ============= -->
                            <!-- ================ For Add Transaction Type =================== -->
                            <!-- <div class="grid grid-cols-2 p-1 gap-1"> -->
                            <!-- ================ Field for Loan =================== -->
                            @if (loanForm.value.transactionType == 2) {
                              <div class="border-2 p-4 rounded-sm">
                                <div class="flex flex-wrap gap-2 h-12">
                                  @if (loanForm.value.transactionType == 2) {
                                    <mat-form-field appearance="outline">
                                      <mat-label class="label-font-size">Loan Type</mat-label>
                                      <mat-icon class="uploadbutton mb-2" matPrefix
                                      svgIcon="mat_outline:info"></mat-icon>
                                      <mat-select (selectionChange)="resetType('lT');changeLoanType($event)" formControlName="loanType">
                                        @for (item of loans; track item) {
                                          <mat-option [value]="item.id">
                                            {{item.description}}
                                          </mat-option>
                                        }
                                      </mat-select>
                                    </mat-form-field>
                                  }
                                  @if (loanForm.value.loanType == 2) {
                                    <mat-form-field  class="w-32" appearance="outline">
                                      <mat-label class="label-font-size"></mat-label>
                                      <input multiple type="file" #loanfile (change)="uploadFileLoan($event,'loanFile','lT')"
                                        class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                        accept=".xlsx" (click)="$event.target.value=null"/>
                                        <input readonly matInput id="loanFile" formControlName="uploadFile"
                                          cdkFocusInitial class="z-0" (change)="uploadFileLoan($event,'loanFile','lT')" />
                                          <mat-icon class="mb-2" matPrefix
                                          svgIcon="mat_outline:upload"></mat-icon>
                                          <button class="upload" matSuffix mat-button
                                          color="primary" (click)="loanfile.click()" [disabled]="buttonDisabled">Upload</button>
                                        </mat-form-field>
                                      }
                                      @if (loanForm.value.loanType == 4) {
                                        <mat-form-field class="w-32" appearance="outline">
                                          <mat-label class="label-font-size"></mat-label>
                                          <input multiple type="file" #adjustment (change)="DynamicUploadFile($event,'adjustment','loanSource','lT')"
                                            class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0" accept=".xlsx"
                                            (click)="$event.target.value=null" />
                                            <input readonly matInput id="adjustment" formControlName="uploadFile" cdkFocusInitial class="z-0"
                                              (change)="DynamicUploadFile($event,'adjustment','loanSource')" />
                                              <mat-icon class="mb-2" matPrefix svgIcon="mat_outline:upload"></mat-icon>
                                              <button class="upload" matSuffix mat-button color="primary" (click)="adjustment.click()"
                                              [disabled]="buttonDisabled">Upload</button>
                                            </mat-form-field>
                                          }
                                          @if (loanForm.value.loanType == 3) {
                                            <mat-form-field appearance="outline">
                                              <mat-label class="label-font-size">{{t('loanAttendanceCode')}}</mat-label>
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select formControlName="loanACode">
                                                @for (item of code; track item) {
                                                  <mat-option [value]="item.id">
                                                    {{item.description}}
                                                  </mat-option>
                                                }
                                              </mat-select>
                                            </mat-form-field>
                                          }
                                          @if (showMe(loanForm.value.loanType,[4]) || loanForm.value.transactionType == 1) {
                                            <button
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="download('New Adjustment Upload Template')"
                                              matTooltip="Download">
                                              <mat-icon class="mb-2" [svgIcon]="'mat_outline:download'"></mat-icon>
                                            </button>
                                          }
                                          @if (showMe(loanForm.value.loanType,[2]) || loanForm.value.transactionType == 1) {
                                            <button
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="download('New Loans Upload Template')"
                                              matTooltip="Download">
                                              <mat-icon mat-icon class="mb-2" [svgIcon]="'mat_outline:download'"></mat-icon>
                                            </button>
                                          }
                                          @if (showMe(loanForm.value.loanType,[2,3,4]) || loanForm.value.transactionType == 1) {
                                            <button
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'"  (click)="Delete('lT',loanForm.value.loanType)"
                                              matTooltip="Delete">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            </button>
                                          }
                                          @if ((showMe(loanForm.value.loanType,[2,3,4]) || loanForm.value.transactionType == 1) && this.showCancel) {
                                            <button
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                              <mat-icon class="mb-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                            </button>
                                          }
                                          @if (showMe(loanForm.value.loanType,[1,2,3,4]) || loanForm.value.transactionType == 1) {
                                            <button
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="submit(this.loanForm.value.loanType,'loans','first','loanType')"
                                              matTooltip="Save">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:save'"></mat-icon>
                                              <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                            </button>
                                          }
                                          
                                          @if (loanForm.value.transactionType == 1) {
                                            <mat-form-field appearance="outline">
                                              <mat-label class="label-font-size">Employee Name</mat-label>
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select formControlName="employeeName">
                                                @for (item of employee; track item) {
                                                  <mat-option [value]="item.id">
                                                    {{item.description}}
                                                  </mat-option>
                                                }
                                              </mat-select>
                                            </mat-form-field>
                                          }
                                          @if (loanForm.value.transactionType == 1) {
                                            <mat-form-field class="w-40" appearance="outline">
                                              <mat-label class="label-font-size">Status</mat-label>
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select formControlName="status">
                                                @for (item of status; track item) {
                                                  <mat-option [value]="item.id">
                                                    {{item.description}}
                                                  </mat-option>
                                                }
                                              </mat-select>
                                            </mat-form-field>
                                          }
                                        </div>
                                        <div class="grid grid-cols-2 p-1 gap-1">
                                          @if (showMe(loanForm.value.loanType,[2,4])) {
                                            <div class="grid grid-cols-2">
                                              <div>
                                                <p class="text-md pl-3"><strong>Saved files</strong></p>
                                                <mat-card class="scroll-container mat-elevation-z0">
                                                  <app-upload #loanTable
                                                    [checkbox]="deleteShow"
                                                    [cancel]="hideCancel"
                                                    [viewer]="view"
                                                    (selectDel)="delTableL = $event"
                                                    [datasource]="LoanTableSource"
                                                    (deleted)="loanTableDelete = $event"
                                                    [del]="loanTableDelete"
                                                    (selected)="checkTableL = $event;checkersLoan('ulT')"
                                                    [isLoadDone]="true" [isSaveDone]="true">
                                                  </app-upload>
                                                </mat-card>
                                              </div>
                                              <div class="border-l-4">
                                                <br>
                                                  @if (this.LoanSource.length > 0) {
                                                    <mat-card class="scroll-container mat-elevation-z0">
                                                      <app-upload [id]="loanType"
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableDC = $event"
                                                        [datasource]="LoanSource"
                                                        (deleted)="loanDelete = $event"
                                                        (selected)="checkedListLoan = $event;checkersLoan('lT')"
                                                        [del]="loanDelete" [isLoadDone]="loading" [isSaveDone]="saving">
                                                      </app-upload>
                                                    </mat-card>
                                                  }
                                                </div>
                                              </div>
                                            }
                                            <div></div>
                                          </div>
                                        </div>
                                      }
                                      <!-- ================ Field for AB =================== -->
                                      <!-- <div  *ngIf="loanForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                      <div class="flex flex-wrap gap-2 h-12">
                                        <mat-form-field appearance="outline">
                                          <mat-icon class="uploadbutton mb-2" matPrefix
                                          svgIcon="mat_outline:info"></mat-icon>
                                          <mat-select (selectionChange)="resetType('lTAB')" formControlName="loanABType">
                                            <mat-option *ngFor="let item of earn" [value]="item.id">
                                              {{item.description}}
                                            </mat-option>
                                          </mat-select>
                                        </mat-form-field>
                                        <mat-form-field  *ngIf="loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2" class="w-40" appearance="outline">
                                          <input multiple type="file" #loanABfile (change)="uploadFileLoan($event,'loanABFile','lTAB')"
                                            class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                            accept=".xlsx" (click)="$event.target.value=null"/>
                                            <input readonly matInput id="loanABFile" formControlName="uploadFile2"
                                              cdkFocusInitial class="z-0" (change)="uploadFileLoan($event,'loanABFile','lTAB')" />
                                              <mat-icon class="mb-2" matPrefix
                                              svgIcon="mat_outline:upload"></mat-icon>
                                              <button class="upload" matSuffix mat-button
                                              color="primary" (click)="loanABfile.click()" [disabled]="buttonDisabled">Upload</button>
                                            </mat-form-field>
                                            <mat-form-field *ngIf="loanForm.value.loanABType == 3" appearance="outline">
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select formControlName="loanAdjCode">
                                                <mat-option *ngFor="let item of code" [value]="item.id">
                                                  {{item.description}}
                                                </mat-option>
                                              </mat-select>
                                            </mat-form-field>
                                            <button *ngIf="loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2"
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:download'"></mat-icon>
                                            </button>
                                            <button *ngIf="loanForm.value.loanABType == 3 || loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2"
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('lTAB')" matTooltip="Delete">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:delete'"></mat-icon>
                                            </button>
                                            <button *ngIf="loanForm.value.loanABType == 3 || loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2"
                                              class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="Save('second')" matTooltip="Save">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:save'"></mat-icon>
                                            </button>
                                            <mat-form-field *ngIf="loanForm.value.transactionType == 3" appearance="outline">
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select formControlName="loanCode">
                                                <mat-option *ngFor="let item of earn" [value]="item.id">
                                                  {{item.description}}
                                                </mat-option>
                                              </mat-select>
                                            </mat-form-field>
                                          </div>
                                          ================ Upload list view for AB ===================
                                          <mat-card *ngIf="this.LoanABSource.length > 0" class="scroll-container mat-elevation-z0">
                                            <app-upload [id]="loanTypeAB"
                                              [datasource]="LoanABSource"
                                              (deleted)="loanABDelete2 = $event"
                                              (selected)="checkedListLoanAB = $event;checkersLoan('lTAB')"
                                              [del]="loanABDelete2" [isLoadDone]="loading" [isSaveDone]="saving">
                                            </app-upload>
                                          </mat-card>
                                        </div> -->
                                      <!-- </div> -->
                                      <div class="mt-5">
                                        <!-- ================ Filter field=================== -->
                                        @if ((loanForm.value.transactionType === 2) && showMe(loanForm.value.loanType,[2,3,4])) {
                                          <div class="flex flex-wrap place-content-between">
                                            <div class="flex flex-wrap gap-2 ">
                                              <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size">{{t('loans')}}</mat-label>
                                                <mat-icon class="uploadbutton mb-2" matPrefix
                                                svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListLoan.length == 0" (selectionChange)="checkersLoan('lT');switchLoan('lT')" formControlName="loan">
                                                  @for (item of tk1; track item) {
                                                    <mat-option [value]="item.id">
                                                      {{item.description}}
                                                    </mat-option>
                                                  }
                                                </mat-select>
                                              </mat-form-field>
                                              <!-- <mat-form-field class="text-md h-10" appearance="outline">
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select [disabled]="this.checkedListLoanAB.length == 0" (selectionChange)="checkersLoan('lTAB');switchLoan('lTAB')" formControlName="attendance">
                                                <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                  {{item.description}}
                                                </mat-option>
                                              </mat-select>
                                            </mat-form-field> -->
                                          </div>
                                          <div class="flex flex-wrap gap-2">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                              <mat-label class="label-font-size"></mat-label>
                                              <input formControlName="search" matInput placeholder="Search...">
                                            </mat-form-field>
                                            <button (click)="search('l')" class="mb-5"  mat-flat-button [color]="'primary'">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:search'"></mat-icon>
                                              <span class="hidden sm:inline-block ml-2">Search</span>
                                            </button>
                                            <button class="mb-5" mat-flat-button color="primary">
                                              <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                            </button>
                                          </div>
                                        </div>
                                      }
                                      <!-- ================ Table List view =================== -->
                                      @if ((loanForm.value.loan == 1 || loanForm.value.loan == 2) && loanSource.length > 0 || loanSource.length > 0) {
                                        <div>
                                          <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                          <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-loan [id]="earnT" [loanType]="loanForm.value.loanType" [datasource]="loanSource" (tablefilter)="nextPage($event,'lT','',false)" [totalRows]="totalRows" [searchVal]="searchTermL" [error]="columnHideL"></app-loan>
                                          </mat-card>
                                        </div>
                                      }
                                      @if (this.checkTableL.length > 0 && this.checkedListLoan.length === 0) {
                                        <div>
                                          <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                          <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-loan [datasource]="loanUpload" (tablefilter)="nextPage($event,'ulT','',true)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideL"></app-loan>
                                          </mat-card>
                                        </div>
                                      }
                                      @if ((loanForm.value.attendance == 1 || loanForm.value.attendance == 2) && loanABSource.length > 0) {
                                        <div>
                                          <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-loan [id]="earnT" [datasource]="loanABSource" (tablefilter)="nextPage($event,'lTAB','',false)" [totalRows]="totalRows" [searchVal]="searchTermL" [error]="columnHideL"></app-loan>
                                          </mat-card>
                                        </div>
                                      }
                                      @if (loanForm.value.transactionType == 1 && loanESource.length > 0) {
                                        <div>
                                          <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-loan [id]="earnT" [datasource]="loanESource" (tablefilter)="nextPage($event,'lE','',false)" [totalRows]="totalRows" [searchVal]="searchTermL" [error]="columnHideL"></app-loan>
                                          </mat-card>
                                        </div>
                                      }
                                    </div>
                                    @if (loanForm.value.loanType == 1) {
                                      <div class="relative h-100">
                                        <app-payroll-loans [shared]="true" [frequency]="detailForm.value.cutoffID" [payrollType]="detailForm.value.payoutTypeID" (formChanged)="PatchLoans($event)" [_id]="selectedCategory" [data]="payrollloansForm" [hidebuttons]="true" [parentDetail]="parentDetail" ></app-payroll-loans>
                                      </div>
                                    }
                                    <br><br><br>
                                  </mat-card>
                                </form>
                              </mat-step>
                            }

                            <!-- ===================================================== GOV'T CONTRIBUTION =========================================================== -->

                            @if (showSteper(5)) {
                              <mat-step [stepControl]="contributionForm">
                                <form [formGroup]="contributionForm">
                                  <ng-template matStepLabel>Gov't Contribution</ng-template>
                                  <mat-card>
                                    <!-- ============== UPLOAD FILE ============= -->
                                    <div>
                                      <div>
                                        <div class="flex flex-wrap gap-2 h-12">
                                          <mat-form-field appearance="outline" class="h-12 w-48">
                                            <mat-label class="label-font-size">{{t('transactionType')}}</mat-label>
                                            <mat-icon class="uploadbutton mb-2" matPrefix
                                            svgIcon="mat_outline:info"></mat-icon>
                                            <mat-select (selectionChange)="resetType('gc')" formControlName="transactionType">
                                              @for (item of earn; track item) {
                                                <mat-option [value]="item.id">
                                                  {{item.description}}
                                                </mat-option>
                                              }
                                            </mat-select>
                                          </mat-form-field>
                                          @if (contributionForm.value.transactionType == 2) {
                                            <mat-form-field class="w-40" appearance="outline">
                                              <mat-label class="label-font-size"></mat-label>
                                              <input multiple type="file" #govtfile (change)="uploadFilegov($event,'govtFile','ugT')"
                                                class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0" accept=".xlsx" (click)="$event.target.value=null"/>
                                                <input readonly matInput id="govtFile" formControlName="uploadFile" cdkFocusInitial class="z-0"
                                                  (change)="uploadFilegov($event,'govtFile','ugT')" />
                                                  <mat-icon class="mb-2" matPrefix svgIcon="mat_outline:upload"></mat-icon>
                                                  <button class="upload" matSuffix mat-button color="primary" (click)="govtfile.click()" [disabled]="buttonDisabled">Upload</button>
                                                </mat-form-field>
                                              }
                                              @if (contributionForm.value.transactionType == 3) {
                                                <div style="display: flex; flex-direction: row;">
                                                  <mat-checkbox [color]="'primary'"></mat-checkbox><span class="mt-4">SSS</span>
                                                  <mat-checkbox [color]="'primary'"></mat-checkbox><span class="mt-4">PHIC</span>
                                                  <mat-checkbox [color]="'primary'"></mat-checkbox><span class="mt-4">HDMF</span>
                                                  <mat-checkbox [color]="'primary'"></mat-checkbox><span class="mt-4">TAX</span>
                                                </div>
                                              }
                                              <div class="flex flex-wrap gap-2 ml-2">
                                                @if (contributionForm.value.transactionType == 2) {
                                                  <button class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="download('New GovCon Upload')">
                                                    <mat-icon class="mb-2" [svgIcon]="'mat_outline:download'"></mat-icon>
                                                  </button>
                                                }
                                                @if (contributionForm.value.transactionType === 2) {
                                                  <button
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('gc',0)">
                                                    <mat-icon class="mb-2" [svgIcon]="'mat_outline:delete'"></mat-icon>
                                                  </button>
                                                }
                                                @if (contributionForm.value.transactionType === 2 && this.showCancel) {
                                                  <button
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                    <mat-icon class="mb-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                                  </button>
                                                }
                                                @if (contributionForm.value.transactionType == 2 || contributionForm.value.transactionType == 3) {
                                                  <button
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="submit(this.contributionForm.value.transactionType,'govcon','first','govType')" [disabled]="buttonDisabled">
                                                    <mat-icon class="mb-2" [svgIcon]="'mat_outline:save'"></mat-icon>
                                                    <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                                  </button>
                                                }
                                              </div>
                                            </div>
                                            <!-- ================ Upload list view =================== -->
                                            @if (contributionForm.value.transactionType === 2) {
                                              <div class="grid grid-cols-2 gap-2">
                                                <div class="grid grid-cols-2 gap-2">
                                                  <div>
                                                    <p class="text-md pl-3"><strong>Saved files</strong></p>
                                                    <mat-card class="scroll-container mat-elevation-z0">
                                                      <app-upload #govtTable
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableG = $event"
                                                        [datasource]="GovTableSource"
                                                        (deleted)="govTableDelete = $event"
                                                        [del]="govTableDelete"
                                                        (selected)="checkTableG = $event;checkersGov('ugT')"
                                                        [isLoadDone]="true"
                                                        [isSaveDone]="true">
                                                      </app-upload>
                                                    </mat-card>
                                                  </div>
                                                  <div class="border-l-4">
                                                    <br>
                                                      @if (this.GovtSource.length > 0) {
                                                        <mat-card class="scroll-container mat-elevation-z0">
                                                          <app-upload [id]="'govtfile'"
                                                            [checkbox]="deleteShow"
                                                            [cancel]="hideCancel"
                                                            [viewer]="view"
                                                            (selectDel)="delTableGC = $event"
                                                            [datasource]="GovtSource"
                                                            (deleted)="govtDelete = $event"
                                                            (selected)="checkedListGov = $event; checkersGov('gT')"
                                                            [del]="govtDelete"
                                                            [isLoadDone]="loading"
                                                            [isSaveDone]="saving">
                                                          </app-upload>
                                                        </mat-card>
                                                      }
                                                    </div>
                                                  </div>
                                                  <div></div>
                                                </div>
                                              }
                                            </div>
                                          </div>
                                          <!-- ================ Filter field =================== -->
                                          @if (contributionForm.value.transactionType === 2) {
                                            <div class="mt-5">
                                              <div class="flex flex-wrap place-content-between">
                                                <div class="flex flex-wrap gap-2 ">
                                                  <mat-form-field class="text-md h-10" appearance="outline">
                                                    <mat-label class="label-font-size">{{t('govtContribution')}}</mat-label>
                                                    <mat-icon class="uploadbutton mb-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select [disabled]="this.checkedListGov.length == 0" (selectionChange)="checkersGov();switchGov()" formControlName="govcon">
                                                      @for (item of tk1; track item) {
                                                        <mat-option [value]="item.id">
                                                          {{item.description}}
                                                        </mat-option>
                                                      }
                                                    </mat-select>
                                                  </mat-form-field>
                                                </div>
                                                <div class="flex flex-wrap gap-2">
                                                  <mat-form-field class="text-md h-10" appearance="outline">
                                                    <mat-label class="label-font-size"></mat-label>
                                                    <input formControlName="search" matInput placeholder="Search...">
                                                  </mat-form-field>
                                                  <button (click)="search('gc')" class="mb-5" mat-flat-button [color]="'primary'">
                                                    <mat-icon class="mb-2"
                                                    [svgIcon]="'mat_outline:search'"></mat-icon>
                                                    <span class="hidden sm:inline-block ml-2">Search</span>
                                                  </button>
                                                  <button class="mb-5" mat-flat-button color="primary">
                                                    <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                                  </button>
                                                </div>
                                              </div>
                                            </div>
                                          }
                                          <!-- ================ Table List view =================== -->
                                          @if ((contributionForm.value.govcon == 1 || contributionForm.value.govcon == 2)  && govconSource.length > 0 || govconSource.length > 0) {
                                            <div>
                                              <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                              <mat-card class="scroll-container h-80 mat-elevation-z0">
                                                <app-govcon [id]="earnT"
                                                  [action]="false"
                                                  [datasource]="govconSource"
                                                  (tablefilter)="nextPage($event,'gc','',false)"
                                                  [totalRows]="totalRows"
                                                  [searchVal]="searchTermGc"
                                                  [error]="columnHideG">
                                                </app-govcon>
                                              </mat-card>
                                            </div>
                                          }
                                          @if (this.checkTableG.length > 0 && this.checkedListGov.length === 0) {
                                            <div>
                                              <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                              <mat-card class="scroll-container h-80 mat-elevation-z0">
                                                <app-govcon [datasource]="govtUpload" (tablefilter)="nextPage($event,'ugT','',true)" [totalRows]="totalRows" [searchVal]="searchTermGc" [error]="columnHideG"></app-govcon>
                                              </mat-card>
                                            </div>
                                          }
                                          <br><br><br>
                                        </mat-card>
                                      </form>
                                    </mat-step>
                                  }

                                  <!-- ===================================================== GENERATE PAYROLL =========================================================== -->

                                  @if (showSteper(6)) {
                                    <mat-step [stepControl]="generateForm">
                                      <form [formGroup]="generateForm">
                                        <ng-template matStepLabel>Generate Payroll</ng-template>
                                        <mat-card>
                                          @if (bank) {
                                            <div>
                                              <!-- ============== UPLOAD FILE ============= -->
                                              <div class="border-2 p-4 rounded-sm">
                                                <div class="flex flex-wrap gap-2 place-content-between p-2">
                                                  <div class="flex flex-wrap gap-2">
                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                      <mat-label class="label-font-size">{{t('payRegister')}}</mat-label>
                                                      <mat-icon class="uploadbutton mb-2" matPrefix
                                                      svgIcon="mat_outline:info"></mat-icon>
                                                      <mat-select formControlName="payRegister">
                                                        @for (item of tk1; track item) {
                                                          <mat-option [value]="item.id">
                                                            {{item.description}}
                                                          </mat-option>
                                                        }
                                                      </mat-select>
                                                    </mat-form-field>
                                                    <button mat-flat-button color="primary" class="text-md">
                                                      <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:download" matTooltip="Download"></mat-icon>
                                                    </button>
                                                    @if (!isUploads) {
                                                      <button class="text-md" mat-flat-button [color]="'primary'" [disabled]="this.buttonDisabled" (click)="generatePayroll()">Calculate Payroll</button>
                                                    }
                                                    <button mat-flat-button color="primary" class="text-md" (click)="exportall()">
                                                      <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:download"></mat-icon>Payroll Register
                                                    </button>
                                                  </div>
                                                  <div class="flex flex-wrap gap-2">
                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                      <mat-label class="label-font-size">{{t('payslip')}}</mat-label>
                                                      <mat-icon class="uploadbutton mb-2" matPrefix
                                                      svgIcon="mat_outline:info"></mat-icon>
                                                      <mat-select formControlName="payslip">
                                                        @for (item of payslip; track item) {
                                                          <mat-option [value]="item.id">
                                                            {{item.description}}
                                                          </mat-option>
                                                        }
                                                      </mat-select>
                                                    </mat-form-field>
                                                    <button (click)="proceed()" mat-flat-button color="primary" class="text-md">
                                                      <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:double_arrow" matTooltip="Proceed"></mat-icon>
                                                    </button>
                                                    <button (click)="onBank()" class="text-md" mat-flat-button [color]="'primary'">Bank File</button>
                                                    <button (click)="openModalApprove()" class="text-md" mat-flat-button [color]="'primary'">Lock Payroll</button>
                                                  </div>
                                                </div>
                                              </div>
                                              <!------------------------- Tabs sector ----------------------------->
                                              <div class="mt-5 h-full">
                                                <div class="flex flex-wrap gap-1 place-content-between">
                                                  <div class="flex flex-wrap gap-1 ">
                                                    <!-- <div (click)="changeTab('pei')"
                                                    class="relative flex self-start pt-2 pl-2 pb-1 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isPeIfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2">
                                                      </div>
                                                    </div>
                                                  </div> -->
                                                  <div (click)="changeTab('woi')"
                                                    class="relative flex self-start pt-2 pl-2 pb-1 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isWoIfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject1)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2">
                                                      </div>
                                                    </div>
                                                  </div>
                                                  <div (click)="changeTab('pai')"
                                                    class="relative self-start pt-2 pb-1 pl-2  pr-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isPaIfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject2)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                  </div>
                                                  <div (click)="changeTab('s')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isSfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject3)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                  </div>
                                                  <div (click)="changeTab('l')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isLfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject4)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                  </div>
                                                  <div (click)="changeTab('O')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isOtherfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject5)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                  </div>
                                                  <div (click)="changeTab('E')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isEfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject6)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                  </div>
                                                  <div (click)="changeTab('A')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isAdfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                      <div class="overflow-hidden">
                                                        <div class="font-medium leading-6 truncate">{{t(selectedProject7)}}</div>
                                                      </div>
                                                      <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                  </div>
                                                </div>
                                                <div class="flex flex-wrap gap-1">
                                                  <div class="flex flex-wrap gap-1">
                                                    <mat-form-field class="text-md h-5 mt-3" appearance="outline">
                                                      <mat-label class="label-font-size">{{t('employeeCode')}}</mat-label>
                                                      <input matInput [placeholder]="'Employee Code'" formControlName="employeeCode">
                                                    </mat-form-field>
                                                  </div>
                                                  <div class="flex flex-wrap gap-1">
                                                    <mat-form-field class="text-md h-5 mt-3" appearance="outline">
                                                      <mat-label class="label-font-size">{{t('firstName')}}</mat-label>
                                                      <input matInput [placeholder]="'First Name'" formControlName="firstName">
                                                    </mat-form-field>
                                                  </div>
                                                  <div class="flex flex-wrap gap-1">
                                                    <mat-form-field class="text-md h-5 mt-3" appearance="outline">
                                                      <mat-label class="label-font-size">{{t('lastName')}}</mat-label>
                                                      <input matInput [placeholder]="'Last Name'" formControlName="lastName">
                                                    </mat-form-field>
                                                  </div>
                                                  <div class="mb-3">
                                                    <mat-form-field class="text-md h-5 mt-3" appearance="outline">
                                                      <mat-label class="label-font-size">{{t('payslipStatus')}}</mat-label>
                                                      <mat-icon class="uploadbutton mb-2" matPrefix
                                                      svgIcon="mat_outline:info"></mat-icon>
                                                      <mat-select formControlName="payslipStatus">
                                                        @for (item of stat; track item) {
                                                          <mat-option [value]="item.id">
                                                            {{item.description}}
                                                          </mat-option>
                                                        }
                                                      </mat-select>
                                                    </mat-form-field>
                                                  </div>
                                                  <button mat-flat-button class="mt-3" [color]="'primary'" (click)="searchParams(this.generateForm,'gp')" matTooltip="Search">
                                                    <mat-icon class="mb-2" [svgIcon]="'mat_outline:search'" ></mat-icon>
                                                  </button>
                                                  <button mat-flat-button color="primary" class="text-md mt-3" matTooltip="Export">
                                                    <mat-icon class="mb-2" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>
                                                  </button>
                                                  @if (detailForm.value.payoutTypeID === 12720) {
                                                    <button (click)="ytd_2316()" mat-flat-button color="primary" class="text-md mt-3" matTooltip="Export"> 2316 and YTD
                                                    </button>
                                                  }
                                                </div>
                                              </div>
                                              <!-- Main -->
                                              <div class=" w-full flex-auto border-t mt-3 pt-4 sm:pt-6" *transloco="let t">
                                                <div class="w-full">
                                                  <!-- Tabs -->
                                                  <!-- Summary -->
                                                  <!-- <div [hidden]="!isPeI" class="bg-card shadow rounded-2xl">
                                                  <mat-card class="scroll-container mat-elevation-z0">
                                                  </mat-card>
                                                </div> -->
                                                <!-- Payreg -->
                                                <div class="bg-card shadow rounded-2xl h-full"  [hidden]="!isWoI">
                                                  @if (payregSource?.length > 0) {
                                                    <app-generate
                                                      (selected)="payRegCheck = $event"
                                                      (excludedList)="payRegExclude = $event"
                                                      [checkbox]="true"
                                                      [datasource]="payregSource"
                                                      (tablefilter)="nextPage($event,'gp','payreg','')"
                                                      [totalRows]="totalRows1"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [cols]="payregColumns"
                                                      [details]="false"
                                                      [avoidChecked]="true"
                                                      [hideCols]="true"
                                                      (passCheck)="allSelected = $event">
                                                    </app-generate>
                                                  }
                                                </div>
                                                <!-- Misc -->
                                                <div class="bg-card shadow rounded-2xl " [hidden]="!isPaI">
                                                  @if (miscSource?.length > 0) {
                                                    <app-generate
                                                      [datasource]="miscSource"
                                                      (tablefilter)="nextPage($event,'gp','misc','')"
                                                      [totalRows]="totalRows2"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [cols]="miscColumns"
                                                      [details]="false"
                                                      [avoidChecked]="true"
                                                      [hideCols]="true">
                                                    </app-generate>
                                                  }
                                                </div>
                                                <!-- OtSheet -->
                                                <div class="bg-card shadow rounded-2xl " [hidden]="!isS">
                                                  @if (otSource?.length > 0) {
                                                    <app-generate
                                                      [datasource]="otSource"
                                                      (tablefilter)="nextPage($event,'gp','ot','')"
                                                      [totalRows]="totalRows3"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [cols]="otColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                                    </app-generate>
                                                  }
                                                </div>
                                                <!-- Tax -->
                                                <div class="bg-card shadow rounded-2xl" [hidden]="!isL">
                                                  @if (taxSource?.length > 0) {
                                                    <app-generate
                                                      [datasource]="taxSource"
                                                      (tablefilter)="nextPage($event,'gp','tax','')"
                                                      [totalRows]="totalRows4"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [cols]="taxColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                                    </app-generate>
                                                  }
                                                </div>
                                                <!-- NTax -->
                                                <div class="bg-card shadow rounded-2xl" [hidden]="!isOther">
                                                  @if (ntaxSource?.length > 0) {
                                                    <app-generate
                                                      [datasource]="ntaxSource"
                                                      (tablefilter)="nextPage($event,'gp','ntax','')"
                                                      [totalRows]="totalRows5"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [cols]="ntaxColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                                    </app-generate>
                                                  }
                                                </div>
                                                <!-- Loan -->
                                                <div class="bg-card shadow rounded-2xl" [hidden]="!isException">
                                                  @if (loanGPSource?.length > 0) {
                                                    <app-generate
                                                      [datasource]="loanGPSource"
                                                      (tablefilter)="nextPage($event,'gp','loan','')"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [totalRows]="totalRows6"
                                                      [cols]="loanColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                                    </app-generate>
                                                  }
                                                </div>
                                                <!-- Deductions -->
                                                <div class="bg-card shadow rounded-2xl" [hidden]="!isAdmin">
                                                  @if (dedSource?.length > 0) {
                                                    <app-generate
                                                      [datasource]="dedSource"
                                                      (tablefilter)="nextPage($event,'gp','ded','')"
                                                      [totalRows]="totalRows7"
                                                      [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                      [cols]="dedColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                                    </app-generate>
                                                  }
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      }
                                      @if (!bank) {
                                        <div>
                                          <mat-card-title>
                                            <app-card-title title="Bank File" [sub]="false" [back]="false" [return]="true" (returnTap)="onGP()"></app-card-title>
                                          </mat-card-title>
                                          <div class="flex flex-wrap gap-2">
                                            <!-- <app-payroll-hierarchy [showTag]="false" [notincludetag]="[-3, 132,-4]" [defaultTag]="defaultTag" [multiple]="true" [resultHierarchy]="resultHierarchy" [payrollID]="payrollId" [all]="true"></app-payroll-hierarchy> -->
                                            <!-- <div class="flex flex-wrap gap-2"> -->
                                            <app-employee-hierarchy [multiple]="true" [all]="true" [showTag]="false" [notincludetag]="[-3, 132,-4]" [defaultTag]="defaultTag" [paycodes]="payrollId"
                                            [resultHierarchy]="resultHierarchy"></app-employee-hierarchy>
                                            <mat-form-field appearance="outline">
                                              <mat-label class="label-font-size">{{t('withBankAccount')}}</mat-label>
                                              <mat-icon class="uploadbutton mb-2" matPrefix
                                              svgIcon="mat_outline:info"></mat-icon>
                                              <mat-select formControlName="bankOption">
                                                @for (item of ba; track item) {
                                                  <mat-option [value]="item.id">
                                                    {{item.description}}
                                                  </mat-option>
                                                }
                                              </mat-select>
                                            </mat-form-field>
                                            <button class="mb-5"  mat-flat-button [color]="'primary'" matTooltip="Search" (click)="loadBankTable(true)">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:search'"></mat-icon>
                                              <!-- <span class="hidden sm:inline-block ml-2">Search</span> -->
                                            </button>
                                            <button class="mb-5"  mat-flat-button [color]="'primary'" matTooltip="Export">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:file_upload'"></mat-icon>
                                              <!-- <span class="hidden sm:inline-block ml-2">Export</span> -->
                                            </button>
                                            <button class="mb-5"  mat-flat-button [color]="'primary'" (click)="dialogModal()" matTooltip="Generate">
                                              <mat-icon class="mb-2"
                                              [svgIcon]="'mat_outline:refresh'"></mat-icon>
                                              <!-- <span class="hidden sm:inline-block ml-2">Generate</span> -->
                                            </button>
                                          <!-- </div> -->
                                        </div>
                                        <div class="bg-card shadow rounded-2xl h-full">
                                          @if (bankSource.length > 0) {
                                            <app-generate [datasource]="bankSource" (tablefilter)="nextPage($event,'bank','','')" [totalRows]="totalRowsBank" [cols]="bankColumns" [details]="false" [hideCols]="true"></app-generate>
                                          }
                                        </div>
                                        <!-- <div class="flex justify-center items-center">
                                        <button  mat-flat-button (click)="onGP()" [color]="'primary'" >Previous</button>
                                      </div> -->
                                    </div>
                                  }
                                </mat-card>
                              </form>
                            </mat-step>
                          }
